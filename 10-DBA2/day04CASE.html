
<!-- saved from url=(0073)http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>CASE</title>
    
    <script type="text/javascript" src="./day04CASE_files/jquery.min.js">
    </script>
    <script type="text/javascript" src="./day04CASE_files/jquery.snippet.js">
    </script>
    <script type="text/javascript" src="./day04CASE_files/main.js">
    </script>
    <link type="text/css" href="./day04CASE_files/index.css" rel="Stylesheet">
    <link type="text/css" href="./day04CASE_files/jquery.snippet.css" rel="Stylesheet">
  </head>
  <body>
    <div class="source_style_case">
      <a name="page_top_case" id="top_anchor">
      </a><a id="link_top" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#page_top_case">Top</a>
      <h1>NSD DBA2 DAY04</h1>
      <ol class="index">
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#case1">案例1：测试MHA集群</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#case2">案例2：视图的基本使用</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#case3">案例3：视图进阶操作</a>
        </li>
      </ol>
      <a name="case1">
      </a>
      <h2>1 案例1：测试MHA集群</h2>
      <h3>1.1 问题</h3>
      <ul class="list">
        <li>查看MHA集群状态
</li>
        <li>测试节点之间的SSH登录
</li>
        <li>测试集群VIP的故障切换功能
</li>
      </ul>
      <h3>1.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：验证配置</p>
      <p>1）检查配置环境，在主机52，53检查是否有同步数据的用户repluser</p>
      <p>主机52:</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style=""><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> select user<span class="sh_symbol">,</span>host from mysql<span class="sh_symbol">.</span>user where user<span class="sh_symbol">=</span><span class="sh_string">"repluser"</span><span class="sh_symbol">;</span></li><li><span class="sh_symbol">+----------+------+</span></li><li><span class="sh_symbol">|</span> user     <span class="sh_symbol">|</span> host <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+----------+------+</span></li><li><span class="sh_symbol">|</span> repluser <span class="sh_symbol">|</span> <span class="sh_symbol">%</span>    <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+----------+------+</span></li><li><span class="sh_number">1</span> row <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> show grants <span class="sh_keyword">for</span> repluser@<span class="sh_string">"%"</span><span class="sh_symbol">;</span></li><li><span class="sh_symbol">+--------------------------------------------------+</span></li><li><span class="sh_symbol">|</span> Grants <span class="sh_keyword">for</span> repluser@<span class="sh_symbol">%</span>                            <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+--------------------------------------------------+</span></li><li><span class="sh_symbol">|</span> GRANT REPLICATION SLAVE ON <span class="sh_symbol">*.*</span> TO <span class="sh_string">'repluser'</span>@<span class="sh_string">'%'</span> <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+--------------------------------------------------+</span></li><li><span class="sh_number">1</span> row <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; select user,host from mysql.user where user="repluser";
+----------+------+
| user     | host |
+----------+------+
| repluser | %    |
+----------+------+
1 row in set (0.00 sec)

mysql&gt; show grants for repluser@"%";
+--------------------------------------------------+
| Grants for repluser@%                            |
+--------------------------------------------------+
| GRANT REPLICATION SLAVE ON *.* TO 'repluser'@'%' |
+--------------------------------------------------+
1 row in set (0.00 sec
</pre></div></div>
      <p>主机53:</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> select user<span class="sh_symbol">,</span>host from mysql<span class="sh_symbol">.</span>user where user<span class="sh_symbol">=</span><span class="sh_string">"repluser"</span><span class="sh_symbol">;</span></li><li><span class="sh_symbol">+----------+------+</span></li><li><span class="sh_symbol">|</span> user     <span class="sh_symbol">|</span> host <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+----------+------+</span></li><li><span class="sh_symbol">|</span> repluser <span class="sh_symbol">|</span> <span class="sh_symbol">%</span>    <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+----------+------+</span></li><li><span class="sh_number">1</span> row <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> show grants <span class="sh_keyword">for</span> repluser@<span class="sh_string">"%"</span><span class="sh_symbol">;</span></li><li><span class="sh_symbol">+--------------------------------------------------+</span></li><li><span class="sh_symbol">|</span> Grants <span class="sh_keyword">for</span> repluser@<span class="sh_symbol">%</span>                               <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+--------------------------------------------------+</span></li><li><span class="sh_symbol">|</span> GRANT REPLICATION SLAVE ON <span class="sh_symbol">*.*</span> TO <span class="sh_string">'repluser'</span>@<span class="sh_string">'%'</span> <span class="sh_symbol">|</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; select user,host from mysql.user where user="repluser";
+----------+------+
| user     | host |
+----------+------+
| repluser | %    |
+----------+------+
1 row in set (0.00 sec)

mysql&gt; show grants for repluser@"%";
+--------------------------------------------------+
| Grants for repluser@%                               |
+--------------------------------------------------+
| GRANT REPLICATION SLAVE ON *.* TO 'repluser'@'%' |
</pre></div></div>
      <p class="number">+--------------------------------------------------+</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_number">1</span> row <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">1 row in set (0.00 sec)
</pre></div></div>
      <p>2）在51的主机上做root的授权，其他的会同步（如果不做，在验证数据节点的主从同步配置时会出错）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> grant all on <span class="sh_symbol">*.*</span> to root@<span class="sh_string">"%"</span> identified by <span class="sh_string">"123456"</span><span class="sh_symbol">;</span></li><li>mysql<span class="sh_symbol">&gt;</span> select user<span class="sh_symbol">,</span>host from mysql<span class="sh_symbol">.</span>user where user<span class="sh_symbol">=</span><span class="sh_string">"root"</span><span class="sh_symbol">;</span></li><li><span class="sh_symbol">+------+-----------+</span></li><li><span class="sh_symbol">|</span> user <span class="sh_symbol">|</span> host      <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+------+-----------+</span></li><li><span class="sh_symbol">|</span> root <span class="sh_symbol">|</span> <span class="sh_symbol">%</span>         <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> root <span class="sh_symbol">|</span> localhost <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+------+-----------+</span></li><li><span class="sh_number">2</span> rows <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; grant all on *.* to root@"%" identified by "123456";
mysql&gt; select user,host from mysql.user where user="root";
+------+-----------+
| user | host      |
+------+-----------+
| root | %         |
| root | localhost |
+------+-----------+
2 rows in set (0.00 sec)
</pre></div></div>
      <p>3）验证ssh 免密登陆数据节点主机</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@mgm56 mha4mysql<span class="sh_symbol">-</span>manager<span class="sh_number">-0.56</span><span class="sh_symbol">]</span>#  <span class="sh_normal">cd </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span></li><li><span class="sh_symbol">[</span>root@mgm56 bin<span class="sh_symbol">]</span># masterha_check_ssh  <span class="sh_symbol">--</span>conf<span class="sh_symbol">=</span><span class="sh_regexp">/etc/m</span><span class="sh_normal">ha_manager</span><span class="sh_symbol">/</span>app1<span class="sh_symbol">.</span>cnf</li><li>Wed Sep <span class="sh_number">19</span> <span class="sh_number">09</span><span class="sh_symbol">:</span><span class="sh_number">09</span><span class="sh_symbol">:</span><span class="sh_number">33</span> <span class="sh_number">2018</span> <span class="sh_symbol">-</span> <span class="sh_symbol">[</span>info<span class="sh_symbol">]</span> All SSH connection tests passed successfully<span class="sh_symbol">.</span></li><li><span class="sh_comment">//出现这个为成功</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@mgm56 mha4mysql-manager-0.56]#  cd /usr/local/bin/
[root@mgm56 bin]# masterha_check_ssh  --conf=/etc/mha_manager/app1.cnf
Wed Sep 19 09:09:33 2018 - [info] All SSH connection tests passed successfully.
//出现这个为成功
</pre></div></div>
      <p>4）验证数据节点的主从同步配置（先把自动failover时候的切换脚本注释掉）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@mgm56 bin<span class="sh_symbol">]</span>#  masterha_check_repl <span class="sh_symbol">--</span>conf<span class="sh_symbol">=</span><span class="sh_regexp">/etc/m</span><span class="sh_normal">ha_manager</span><span class="sh_symbol">/</span>app1<span class="sh_symbol">.</span>cnf</li><li>MySQL Replication Health is OK<span class="sh_symbol">.</span>  <span class="sh_comment">//验证成功</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@mgm56 bin]#  masterha_check_repl --conf=/etc/mha_manager/app1.cnf
MySQL Replication Health is OK.  //验证成功

</pre></div></div>
      <p>5）启动管理服务MHA_Manager</p>
      <p>--remove_dead_master_conf	  //删除宕机主库配置</p>
      <p>--ignore_last_failover  	  //忽略xxx.health文件</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@mgm56 bin<span class="sh_symbol">]</span># masterha_manager <span class="sh_symbol">--</span>conf<span class="sh_symbol">=</span><span class="sh_regexp">/etc/m</span><span class="sh_normal">ha_manager</span><span class="sh_symbol">/</span>app1<span class="sh_symbol">.</span>cnf <span class="sh_symbol">\</span>  </li><li> <span class="sh_symbol">--</span>remove_dead_master_conf <span class="sh_symbol">--</span>ignore_last_failover </li><li><span style="display:none;">&nbsp;</span></li><li>Wed Sep <span class="sh_number">19</span> <span class="sh_number">09</span><span class="sh_symbol">:</span><span class="sh_number">24</span><span class="sh_symbol">:</span><span class="sh_number">41</span> <span class="sh_number">2018</span> <span class="sh_symbol">-</span> <span class="sh_symbol">[</span>warning<span class="sh_symbol">]</span> Global configuration <span class="sh_normal">file </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>masterha_default<span class="sh_symbol">.</span>cnf not found<span class="sh_symbol">.</span> Skipping<span class="sh_symbol">.</span></li><li>Wed Sep <span class="sh_number">19</span> <span class="sh_number">09</span><span class="sh_symbol">:</span><span class="sh_number">24</span><span class="sh_symbol">:</span><span class="sh_number">41</span> <span class="sh_number">2018</span> <span class="sh_symbol">-</span> <span class="sh_symbol">[</span>info<span class="sh_symbol">]</span> Reading application <span class="sh_keyword">default</span> configuration <span class="sh_normal">from </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">mha_manager</span><span class="sh_symbol">/</span>app1<span class="sh_symbol">.</span>cnf<span class="sh_symbol">..</span></li><li>Wed Sep <span class="sh_number">19</span> <span class="sh_number">09</span><span class="sh_symbol">:</span><span class="sh_number">24</span><span class="sh_symbol">:</span><span class="sh_number">41</span> <span class="sh_number">2018</span> <span class="sh_symbol">-</span> <span class="sh_symbol">[</span>info<span class="sh_symbol">]</span> Reading server configuration <span class="sh_normal">from </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">mha_manager</span><span class="sh_symbol">/</span>app1<span class="sh_symbol">.</span>cnf<span class="sh_symbol">..</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@mgm56 bin]# masterha_manager --conf=/etc/mha_manager/app1.cnf \  
 --remove_dead_master_conf --ignore_last_failover 

Wed Sep 19 09:24:41 2018 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.
Wed Sep 19 09:24:41 2018 - [info] Reading application default configuration from /etc/mha_manager/app1.cnf..
Wed Sep 19 09:24:41 2018 - [info] Reading server configuration from /etc/mha_manager/app1.cnf..
</pre></div></div>
      <p>6）查看状态（另开一个终端）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@mgm56 <span class="sh_symbol">~]</span># masterha_check_status  <span class="sh_symbol">--</span>conf<span class="sh_symbol">=</span><span class="sh_regexp">/etc/m</span><span class="sh_normal">ha_manager</span><span class="sh_symbol">/</span>app1<span class="sh_symbol">.</span>cnf</li><li><span class="sh_function">app1</span> <span class="sh_symbol">(</span>pid<span class="sh_symbol">:</span><span class="sh_number">15745</span><span class="sh_symbol">)</span> is <span class="sh_function">running</span><span class="sh_symbol">(</span><span class="sh_number">0</span><span class="sh_symbol">:</span>PING_OK<span class="sh_symbol">),</span> master<span class="sh_symbol">:</span><span class="sh_number">192.168.4.51</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@mgm56 ~]# masterha_check_status  --conf=/etc/mha_manager/app1.cnf
app1 (pid:15745) is running(0:PING_OK), master:192.168.4.51
</pre></div></div>
      <p>7）停止服务</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@mgm56 <span class="sh_symbol">~]</span># masterha_stop  <span class="sh_symbol">--</span>conf<span class="sh_symbol">=</span><span class="sh_regexp">/etc/m</span><span class="sh_normal">ha_manager</span><span class="sh_symbol">/</span>app1<span class="sh_symbol">.</span>cnf</li><li>Stopped app1 successfully<span class="sh_symbol">.</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@mgm56 ~]# masterha_stop  --conf=/etc/mha_manager/app1.cnf
Stopped app1 successfully.
</pre></div></div>
      <p class="number">步骤二：测试故障转移</p>
      <p>1）在主库51上面配置VIP地址</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@master51 <span class="sh_symbol">~]</span># ifconfig eth0<span class="sh_symbol">:</span><span class="sh_number">1</span> <span class="sh_number">192.168.4.100</span><span class="sh_symbol">/</span><span class="sh_number">24</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@master51 ~]# ifconfig eth0:1 192.168.4.100/24

</pre></div></div>
      <p>2）在配置文件里面把自动failover时候的切换脚本去掉注释</p>
      <p>3）修改 master_ip_failover 脚本，设置如下内容</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_number">34</span> my $vip <span class="sh_symbol">=</span> <span class="sh_string">'192.168.4.100/24'</span><span class="sh_symbol">;</span> </li><li> <span class="sh_number">35</span> my $key <span class="sh_symbol">=</span> <span class="sh_string">"1"</span><span class="sh_symbol">;</span></li><li> <span class="sh_number">36</span> my $ssh_start_vip <span class="sh_symbol">=</span> <span class="sh_string">"/sbin/ifconfig eth0:$key $vip"</span><span class="sh_symbol">;</span></li><li> <span class="sh_number">37</span> my $ssh_stop_vip <span class="sh_symbol">=</span> <span class="sh_string">"/sbin/ifconfig eth0:$key down"</span><span class="sh_symbol">;</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">34 my $vip = '192.168.4.100/24'; 
 35 my $key = "1";
 36 my $ssh_start_vip = "/sbin/ifconfig eth0:$key $vip";
 37 my $ssh_stop_vip = "/sbin/ifconfig eth0:$key down";


</pre></div></div>
      <p>4）启动服务</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@mgm56 bin<span class="sh_symbol">]</span># masterha_manager <span class="sh_symbol">--</span>conf<span class="sh_symbol">=</span><span class="sh_regexp">/etc/m</span><span class="sh_normal">ha_manager</span><span class="sh_symbol">/</span>app1<span class="sh_symbol">.</span>cnf <span class="sh_symbol">\</span> </li><li> <span class="sh_symbol">--</span>remove_dead_master_conf <span class="sh_symbol">--</span>ignore_last_failover</li><li>Wed Sep <span class="sh_number">19</span> <span class="sh_number">09</span><span class="sh_symbol">:</span><span class="sh_number">50</span><span class="sh_symbol">:</span><span class="sh_number">33</span> <span class="sh_number">2018</span> <span class="sh_symbol">-</span> <span class="sh_symbol">[</span>warning<span class="sh_symbol">]</span> Global configuration <span class="sh_normal">file </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>masterha_default<span class="sh_symbol">.</span>cnf not found<span class="sh_symbol">.</span> Skipping<span class="sh_symbol">.</span></li><li>Wed Sep <span class="sh_number">19</span> <span class="sh_number">09</span><span class="sh_symbol">:</span><span class="sh_number">50</span><span class="sh_symbol">:</span><span class="sh_number">33</span> <span class="sh_number">2018</span> <span class="sh_symbol">-</span> <span class="sh_symbol">[</span>info<span class="sh_symbol">]</span> Reading application <span class="sh_keyword">default</span> configuration <span class="sh_normal">from </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">mha_manager</span><span class="sh_symbol">/</span>app1<span class="sh_symbol">.</span>cnf<span class="sh_symbol">..</span></li><li>Wed Sep <span class="sh_number">19</span> <span class="sh_number">09</span><span class="sh_symbol">:</span><span class="sh_number">50</span><span class="sh_symbol">:</span><span class="sh_number">33</span> <span class="sh_number">2018</span> <span class="sh_symbol">-</span> <span class="sh_symbol">[</span>info<span class="sh_symbol">]</span> Reading server configuration <span class="sh_normal">from </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">mha_manager</span><span class="sh_symbol">/</span>app1<span class="sh_symbol">.</span>cnf<span class="sh_symbol">..</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@mgm56 bin]# masterha_manager --conf=/etc/mha_manager/app1.cnf \ 
 --remove_dead_master_conf --ignore_last_failover
Wed Sep 19 09:50:33 2018 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.
Wed Sep 19 09:50:33 2018 - [info] Reading application default configuration from /etc/mha_manager/app1.cnf..
Wed Sep 19 09:50:33 2018 - [info] Reading server configuration from /etc/mha_manager/app1.cnf..
</pre></div></div>
      <p>5）查看状态</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@mgm56 <span class="sh_symbol">~]</span># masterha_check_status  <span class="sh_symbol">--</span>conf<span class="sh_symbol">=</span><span class="sh_regexp">/etc/m</span><span class="sh_normal">ha_manager</span><span class="sh_symbol">/</span>app1<span class="sh_symbol">.</span>cnf</li><li>app1 master is down and failover is <span class="sh_function">running</span><span class="sh_symbol">(</span><span class="sh_number">50</span><span class="sh_symbol">:</span>FAILOVER_RUNNING<span class="sh_symbol">).</span> master<span class="sh_symbol">:</span><span class="sh_number">192.168.4.52</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@mgm56 ~]# masterha_check_status  --conf=/etc/mha_manager/app1.cnf
app1 master is down and failover is running(50:FAILOVER_RUNNING). master:192.168.4.52
</pre></div></div>
      <p>验证数据节点的主从同步配置报错，如图-3所示：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@mgm56 bin<span class="sh_symbol">]</span>#  masterha_check_repl <span class="sh_symbol">--</span>conf<span class="sh_symbol">=</span><span class="sh_regexp">/etc/m</span><span class="sh_normal">ha_manager</span><span class="sh_symbol">/</span>app1<span class="sh_symbol">.</span>cnf </li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@mgm56 bin]#  masterha_check_repl --conf=/etc/mha_manager/app1.cnf 
</pre></div></div>
      <div class="image">
        <img src="./day04CASE_files/image001.png">
        <p>图-3</p>
      </div>
      <p>解决办法：</p>
      <p>root用户没有授权，默认只能本地连接，在主机51上面授权root用户可以远程登录，其他主机会同步</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> grant all on <span class="sh_symbol">*.*</span> to root@<span class="sh_string">"%"</span> identified by <span class="sh_string">"123456"</span><span class="sh_symbol">;</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; grant all on *.* to root@"%" identified by "123456";
</pre></div></div>
      <a name="case2">
      </a>
      <h2>2 案例2：视图的基本使用</h2>
      <h3>2.1 问题</h3>
      <ul class="list">
        <li>把/etc/passwd文件的内容存储到db9库下的user表里
</li>
        <li>添加新字段id 存储记录的行号(在所有字段的前边)
</li>
        <li>创建视图v1 结构及数据user表的字段、记录一样。
</li>
        <li>创建视图v2 只有user表shell是/bin/bash用户信息 。
</li>
        <li>分别对视图表和基表执行insert  update  delete 操作。
</li>
        <li>删除视图v1 和 v2
</li>
      </ul>
      <ol class="list">
        <li>
</li>
      </ol>
      <h3>2.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：视图的基本使用</p>
      <p>什么是视图：是一种虚拟存在的表</p>
      <p>内容与真实的表相似，包含一系列带有名称的列和行数据。</p>
      <p>视图并不在数据库中以存储的数据的形式存在。</p>
      <p>行和列的数据来自定义视图时查询所引用的基本表，并且在具体引用视图时动态生成。</p>
      <p>更新视图的数据，就是更新基表的数据</p>
      <p>更新基表数据，视图的数据也会跟着改变</p>
      <p>1）把/etc/passwd文件的内容存储到db9库下的user表里</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@mysql51 <span class="sh_symbol">~]</span># mysql <span class="sh_symbol">-</span>u root <span class="sh_symbol">-</span>p123456</li><li>mysql<span class="sh_symbol">&gt;</span> create database db9<span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">1</span> row <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">10.00</span> sec<span class="sh_symbol">)</span></li><li>mysql<span class="sh_symbol">&gt;</span> create table db9<span class="sh_symbol">.</span><span class="sh_function">user</span><span class="sh_symbol">(</span>username <span class="sh_function">char</span><span class="sh_symbol">(</span><span class="sh_number">20</span><span class="sh_symbol">),</span>password <span class="sh_function">char</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">),</span>uid <span class="sh_symbol">\</span> </li><li><span class="sh_function">int</span><span class="sh_symbol">(</span><span class="sh_number">2</span><span class="sh_symbol">),</span>gid <span class="sh_function">int</span><span class="sh_symbol">(</span><span class="sh_number">2</span><span class="sh_symbol">),</span>comment <span class="sh_function">char</span><span class="sh_symbol">(</span><span class="sh_number">100</span><span class="sh_symbol">),</span>homedir <span class="sh_function">char</span><span class="sh_symbol">(</span><span class="sh_number">100</span><span class="sh_symbol">),</span>shell <span class="sh_function">char</span><span class="sh_symbol">(</span><span class="sh_number">50</span><span class="sh_symbol">));</span></li><li><span class="sh_comment">//创建存储数据的表结构</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.02</span> sec<span class="sh_symbol">)</span></li><li><span class="sh_symbol">[</span>root@mysql51 <span class="sh_symbol">~]</span>#  <span class="sh_normal">cp </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">passwd </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/lib/m</span>ysql<span class="sh_symbol">-</span><span class="sh_normal">files</span><span class="sh_symbol">/</span></li><li><span class="sh_symbol">[</span>root@mysql51 <span class="sh_symbol">~]</span># <span class="sh_normal">ls </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/lib/m</span>ysql<span class="sh_symbol">-</span><span class="sh_normal">files</span><span class="sh_symbol">/</span></li><li>passwd</li><li>mysql<span class="sh_symbol">&gt;</span>  load data infile <span class="sh_string">"/var/lib/mysql-files/passwd"</span>  into table db9<span class="sh_symbol">.</span>user fields terminated by <span class="sh_string">":"</span>  lines terminated by <span class="sh_string">"</span><span class="sh_specialchar">\n</span><span class="sh_string">"</span><span class="sh_symbol">;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//导入文件内容到db9.user</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">41</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.02</span> sec<span class="sh_symbol">)</span></li><li>Records<span class="sh_symbol">:</span> <span class="sh_number">41</span>  Deleted<span class="sh_symbol">:</span> <span class="sh_number">0</span>  Skipped<span class="sh_symbol">:</span> <span class="sh_number">0</span>  Warnings<span class="sh_symbol">:</span> <span class="sh_number">0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@mysql51 ~]# mysql -u root -p123456
mysql&gt; create database db9;
Query OK, 1 row affected (10.00 sec)
mysql&gt; create table db9.user(username char(20),password char(1),uid \ 
int(2),gid int(2),comment char(100),homedir char(100),shell char(50));
//创建存储数据的表结构
Query OK, 0 rows affected (0.02 sec)
[root@mysql51 ~]#  cp /etc/passwd /var/lib/mysql-files/
[root@mysql51 ~]# ls /var/lib/mysql-files/
passwd
mysql&gt;  load data infile "/var/lib/mysql-files/passwd"  into table db9.user fields terminated by ":"  lines terminated by "\n";		//导入文件内容到db9.user
Query OK, 41 rows affected (0.02 sec)
Records: 41  Deleted: 0  Skipped: 0  Warnings: 0
</pre></div></div>
      <p>2）添加新字段id 存储记录的行号(在所有字段的前边)</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span>  alter table db9<span class="sh_symbol">.</span>user add id <span class="sh_function">int</span><span class="sh_symbol">(</span><span class="sh_number">2</span><span class="sh_symbol">)</span> primary key auto_increment first<span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.04</span> sec<span class="sh_symbol">)</span></li><li>Records<span class="sh_symbol">:</span> <span class="sh_number">0</span>  Duplicates<span class="sh_symbol">:</span> <span class="sh_number">0</span>  Warnings<span class="sh_symbol">:</span> <span class="sh_number">0</span></li><li>mysql<span class="sh_symbol">&gt;</span> use db9<span class="sh_symbol">;</span></li><li>mysql<span class="sh_symbol">&gt;</span> desc user<span class="sh_symbol">;</span></li><li><span class="sh_symbol">+----------+-----------+------+-----+---------+----------------+</span></li><li><span class="sh_symbol">|</span> Field    <span class="sh_symbol">|</span> Type      <span class="sh_symbol">|</span> Null <span class="sh_symbol">|</span> Key <span class="sh_symbol">|</span> Default <span class="sh_symbol">|</span> Extra          <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+----------+-----------+------+-----+---------+----------------+</span></li><li><span class="sh_symbol">|</span> id       <span class="sh_symbol">|</span> <span class="sh_function">int</span><span class="sh_symbol">(</span><span class="sh_number">2</span><span class="sh_symbol">)</span>    <span class="sh_symbol">|</span> NO   <span class="sh_symbol">|</span> PRI <span class="sh_symbol">|</span> NULL    <span class="sh_symbol">|</span> auto_increment <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> username <span class="sh_symbol">|</span> <span class="sh_function">char</span><span class="sh_symbol">(</span><span class="sh_number">20</span><span class="sh_symbol">)</span>  <span class="sh_symbol">|</span> YES  <span class="sh_symbol">|</span>     <span class="sh_symbol">|</span> NULL    <span class="sh_symbol">|</span>                <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> password <span class="sh_symbol">|</span> <span class="sh_function">char</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">)</span>   <span class="sh_symbol">|</span> YES  <span class="sh_symbol">|</span>     <span class="sh_symbol">|</span> NULL    <span class="sh_symbol">|</span>                <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> uid      <span class="sh_symbol">|</span> <span class="sh_function">int</span><span class="sh_symbol">(</span><span class="sh_number">2</span><span class="sh_symbol">)</span>    <span class="sh_symbol">|</span> YES  <span class="sh_symbol">|</span>     <span class="sh_symbol">|</span> NULL    <span class="sh_symbol">|</span>                <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> gid      <span class="sh_symbol">|</span> <span class="sh_function">int</span><span class="sh_symbol">(</span><span class="sh_number">2</span><span class="sh_symbol">)</span>    <span class="sh_symbol">|</span> YES  <span class="sh_symbol">|</span>     <span class="sh_symbol">|</span> NULL    <span class="sh_symbol">|</span>                <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> comment  <span class="sh_symbol">|</span> <span class="sh_function">char</span><span class="sh_symbol">(</span><span class="sh_number">100</span><span class="sh_symbol">)</span> <span class="sh_symbol">|</span> YES  <span class="sh_symbol">|</span>     <span class="sh_symbol">|</span> NULL    <span class="sh_symbol">|</span>                <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> homedir  <span class="sh_symbol">|</span> <span class="sh_function">char</span><span class="sh_symbol">(</span><span class="sh_number">100</span><span class="sh_symbol">)</span> <span class="sh_symbol">|</span> YES  <span class="sh_symbol">|</span>     <span class="sh_symbol">|</span> NULL    <span class="sh_symbol">|</span>                <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> shell    <span class="sh_symbol">|</span> <span class="sh_function">char</span><span class="sh_symbol">(</span><span class="sh_number">50</span><span class="sh_symbol">)</span>  <span class="sh_symbol">|</span> YES  <span class="sh_symbol">|</span>     <span class="sh_symbol">|</span> NULL    <span class="sh_symbol">|</span>                <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+----------+-----------+------+-----+---------+----------------+</span></li><li><span class="sh_number">8</span> rows <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt;  alter table db9.user add id int(2) primary key auto_increment first;
Query OK, 0 rows affected (0.04 sec)
Records: 0  Duplicates: 0  Warnings: 0
mysql&gt; use db9;
mysql&gt; desc user;
+----------+-----------+------+-----+---------+----------------+
| Field    | Type      | Null | Key | Default | Extra          |
+----------+-----------+------+-----+---------+----------------+
| id       | int(2)    | NO   | PRI | NULL    | auto_increment |
| username | char(20)  | YES  |     | NULL    |                |
| password | char(1)   | YES  |     | NULL    |                |
| uid      | int(2)    | YES  |     | NULL    |                |
| gid      | int(2)    | YES  |     | NULL    |                |
| comment  | char(100) | YES  |     | NULL    |                |
| homedir  | char(100) | YES  |     | NULL    |                |
| shell    | char(50)  | YES  |     | NULL    |                |
+----------+-----------+------+-----+---------+----------------+
8 rows in set (0.00 sec)
</pre></div></div>
      <p>3）创建视图v1 结构及数据user表的字段、记录一样</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> create view v1 as select <span class="sh_symbol">*</span> from user<span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; create view v1 as select * from user;
Query OK, 0 rows affected (0.00 sec)
</pre></div></div>
      <p>4）创建视图v2 只有user表shell是/bin/bash用户信息</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span>  create view v2 as select shell from user<span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.01</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt;  create view v2 as select shell from user;
Query OK, 0 rows affected (0.01 sec)
</pre></div></div>
      <p>5）分别对视图表和基表执行insert  update  delete 操作</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span>  insert into <span class="sh_function">v1</span><span class="sh_symbol">(</span>username<span class="sh_symbol">,</span>uid<span class="sh_symbol">)</span> <span class="sh_function">values</span><span class="sh_symbol">(</span><span class="sh_string">"jarry"</span><span class="sh_symbol">,</span><span class="sh_number">9</span><span class="sh_symbol">);</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//插入记录</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">1</span> row <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span>  update v1 set uid<span class="sh_symbol">=</span><span class="sh_number">9</span> where username<span class="sh_symbol">=</span><span class="sh_string">"adm"</span><span class="sh_symbol">;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//更新记录</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">1</span> row <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.01</span> sec<span class="sh_symbol">)</span></li><li>Rows matched<span class="sh_symbol">:</span> <span class="sh_number">1</span>  Changed<span class="sh_symbol">:</span> <span class="sh_number">1</span>  Warnings<span class="sh_symbol">:</span> <span class="sh_number">0</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> <span class="sh_keyword">delete</span> from v1 where uid<span class="sh_symbol">=</span><span class="sh_number">9</span><span class="sh_symbol">;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//删除记录</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">2</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.01</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt;  insert into v1(username,uid) values("jarry",9);		//插入记录
Query OK, 1 row affected (0.00 sec)

mysql&gt;  update v1 set uid=9 where username="adm";		//更新记录
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql&gt; delete from v1 where uid=9;			//删除记录
Query OK, 2 rows affected (0.01 sec)
</pre></div></div>
      <p>6）删除视图v1 和 v2</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> drop view v1<span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li>mysql<span class="sh_symbol">&gt;</span> drop view v2<span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; drop view v1;
Query OK, 0 rows affected (0.00 sec)
mysql&gt; drop view v2;
Query OK, 0 rows affected (0.00 sec)
</pre></div></div>
      <p>注意：对视图操作即是对基本操作，反之亦然！！！</p>
      <a name="case3">
      </a>
      <h2>3 案例3：视图进阶操作</h2>
      <h3>3.1 问题</h3>
      <ul class="list">
        <li>练习OR REPLACE的选项使用
</li>
        <li>练习WITH  LOCAL CHECK OPTION 选项的使用
</li>
        <li>练习WITH  CASCADED CHECK OPTION 选项的使用
</li>
      </ul>
      <h3>3.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：视图进阶操作</p>
      <p>1）创建视图完全格式</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span>  create table user2 select  username<span class="sh_symbol">,</span>uid<span class="sh_symbol">,</span>gid from user  limit <span class="sh_number">3</span><span class="sh_symbol">;</span></li><li><span class="sh_comment">//快速建表（user2表）</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">3</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.01</span> sec<span class="sh_symbol">)</span></li><li>Records<span class="sh_symbol">:</span> <span class="sh_number">3</span>  Duplicates<span class="sh_symbol">:</span> <span class="sh_number">0</span>  Warnings<span class="sh_symbol">:</span> <span class="sh_number">0</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> create table info select  username<span class="sh_symbol">,</span>uid<span class="sh_symbol">,</span>homedir<span class="sh_symbol">,</span>shell from user  limit <span class="sh_number">5</span><span class="sh_symbol">;</span></li><li><span class="sh_comment">//快速建表（info表）</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">5</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.02</span> sec<span class="sh_symbol">)</span></li><li>Records<span class="sh_symbol">:</span> <span class="sh_number">5</span>  Duplicates<span class="sh_symbol">:</span> <span class="sh_number">0</span>  Warnings<span class="sh_symbol">:</span> <span class="sh_number">0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt;  create table user2 select  username,uid,gid from user  limit 3;
//快速建表（user2表）
Query OK, 3 rows affected (0.01 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql&gt; create table info select  username,uid,homedir,shell from user  limit 5;
//快速建表（info表）
Query OK, 5 rows affected (0.02 sec)
Records: 5  Duplicates: 0  Warnings: 0
</pre></div></div>
      <p>查询user2.username=info.username的字段</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> select <span class="sh_symbol">*</span> from user2  left join info on  user2<span class="sh_symbol">.</span>username<span class="sh_symbol">=</span>info<span class="sh_symbol">.</span>username<span class="sh_symbol">;</span></li><li><span class="sh_symbol">+----------+------+------+----------+------+---------+---------------+</span></li><li><span class="sh_symbol">|</span> username <span class="sh_symbol">|</span> uid  <span class="sh_symbol">|</span> gid  <span class="sh_symbol">|</span> username <span class="sh_symbol">|</span> uid  <span class="sh_symbol">|</span> homedir <span class="sh_symbol">|</span> shell         <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+----------+------+------+----------+------+---------+---------------+</span></li><li><span class="sh_symbol">|</span> root     <span class="sh_symbol">|</span>    <span class="sh_number">0</span> <span class="sh_symbol">|</span>    <span class="sh_number">0</span> <span class="sh_symbol">|</span> root     <span class="sh_symbol">|</span>    <span class="sh_number">0</span> <span class="sh_symbol">|</span> <span class="sh_regexp">/root   | /</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>bash     <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> bin      <span class="sh_symbol">|</span>    <span class="sh_number">1</span> <span class="sh_symbol">|</span>    <span class="sh_number">1</span> <span class="sh_symbol">|</span> bin      <span class="sh_symbol">|</span>    <span class="sh_number">1</span> <span class="sh_symbol">|</span> <span class="sh_regexp">/bin    | /</span><span class="sh_normal">sbin</span><span class="sh_symbol">/</span>nologin <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> daemon   <span class="sh_symbol">|</span>    <span class="sh_number">2</span> <span class="sh_symbol">|</span>    <span class="sh_number">2</span> <span class="sh_symbol">|</span> daemon   <span class="sh_symbol">|</span>    <span class="sh_number">2</span> <span class="sh_symbol">|</span> <span class="sh_regexp">/sbin   | /</span><span class="sh_normal">sbin</span><span class="sh_symbol">/</span>nologin <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+----------+------+------+----------+------+---------+---------------+</span></li><li><span class="sh_number">3</span> rows <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; select * from user2  left join info on  user2.username=info.username;
+----------+------+------+----------+------+---------+---------------+
| username | uid  | gid  | username | uid  | homedir | shell         |
+----------+------+------+----------+------+---------+---------------+
| root     |    0 |    0 | root     |    0 | /root   | /bin/bash     |
| bin      |    1 |    1 | bin      |    1 | /bin    | /sbin/nologin |
| daemon   |    2 |    2 | daemon   |    2 | /sbin   | /sbin/nologin |
+----------+------+------+----------+------+---------+---------------+
3 rows in set (0.00 sec)
</pre></div></div>
      <p>2）关联查询建的视图 默认不允许修改视图字段的值</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span>  create view v4 as select <span class="sh_symbol">*</span> from user2  left join info on  user2<span class="sh_symbol">.</span>username<span class="sh_symbol">=</span>info<span class="sh_symbol">.</span>username<span class="sh_symbol">;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//创建失败</span></li><li>ERROR <span class="sh_number">1060</span> <span class="sh_symbol">(</span>42S21<span class="sh_symbol">):</span> Duplicate column name <span class="sh_string">'username'</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span>  create view v4 as select a<span class="sh_symbol">.</span>username as ausername<span class="sh_symbol">,</span>b<span class="sh_symbol">.</span>username as busername<span class="sh_symbol">,</span>  a<span class="sh_symbol">.</span>uid as auid<span class="sh_symbol">,</span>b<span class="sh_symbol">.</span>uid as buid  from user2 a  left join info b  on  a<span class="sh_symbol">.</span>username<span class="sh_symbol">=</span>b<span class="sh_symbol">.</span>username<span class="sh_symbol">;</span></li><li><span class="sh_comment">//创建成功</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> select <span class="sh_symbol">*</span> from v4<span class="sh_symbol">;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li><span class="sh_symbol">+-----------+-----------+------+------+</span></li><li><span class="sh_symbol">|</span> ausername <span class="sh_symbol">|</span> busername <span class="sh_symbol">|</span> auid <span class="sh_symbol">|</span> buid <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+-----------+-----------+------+------+</span></li><li><span class="sh_symbol">|</span> root      <span class="sh_symbol">|</span> root      <span class="sh_symbol">|</span>    <span class="sh_number">0</span> <span class="sh_symbol">|</span>    <span class="sh_number">0</span> <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> bin       <span class="sh_symbol">|</span> bin       <span class="sh_symbol">|</span>    <span class="sh_number">1</span> <span class="sh_symbol">|</span>    <span class="sh_number">1</span> <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> daemon    <span class="sh_symbol">|</span> daemon    <span class="sh_symbol">|</span>    <span class="sh_number">2</span> <span class="sh_symbol">|</span>    <span class="sh_number">2</span> <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+-----------+-----------+------+------+</span></li><li><span class="sh_number">3</span> rows <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> desc v4<span class="sh_symbol">;</span></li><li><span class="sh_symbol">+-----------+----------+------+-----+---------+-------+</span></li><li><span class="sh_symbol">|</span> Field     <span class="sh_symbol">|</span> Type     <span class="sh_symbol">|</span> Null <span class="sh_symbol">|</span> Key <span class="sh_symbol">|</span> Default <span class="sh_symbol">|</span> Extra <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+-----------+----------+------+-----+---------+-------+</span></li><li><span class="sh_symbol">|</span> ausername <span class="sh_symbol">|</span> <span class="sh_function">char</span><span class="sh_symbol">(</span><span class="sh_number">20</span><span class="sh_symbol">)</span> <span class="sh_symbol">|</span> YES  <span class="sh_symbol">|</span>     <span class="sh_symbol">|</span> NULL    <span class="sh_symbol">|</span>       <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> busername <span class="sh_symbol">|</span> <span class="sh_function">char</span><span class="sh_symbol">(</span><span class="sh_number">20</span><span class="sh_symbol">)</span> <span class="sh_symbol">|</span> YES  <span class="sh_symbol">|</span>     <span class="sh_symbol">|</span> NULL    <span class="sh_symbol">|</span>       <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> auid      <span class="sh_symbol">|</span> <span class="sh_function">int</span><span class="sh_symbol">(</span><span class="sh_number">2</span><span class="sh_symbol">)</span>   <span class="sh_symbol">|</span> YES  <span class="sh_symbol">|</span>     <span class="sh_symbol">|</span> NULL    <span class="sh_symbol">|</span>       <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> buid      <span class="sh_symbol">|</span> <span class="sh_function">int</span><span class="sh_symbol">(</span><span class="sh_number">2</span><span class="sh_symbol">)</span>   <span class="sh_symbol">|</span> YES  <span class="sh_symbol">|</span>     <span class="sh_symbol">|</span> NULL    <span class="sh_symbol">|</span>       <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+-----------+----------+------+-----+---------+-------+</span></li><li><span class="sh_number">4</span> rows <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt;  create view v4 as select * from user2  left join info on  user2.username=info.username;		//创建失败
ERROR 1060 (42S21): Duplicate column name 'username'

mysql&gt;  create view v4 as select a.username as ausername,b.username as busername,  a.uid as auid,b.uid as buid  from user2 a  left join info b  on  a.username=b.username;
//创建成功
Query OK, 0 rows affected (0.00 sec)

mysql&gt; select * from v4;		
+-----------+-----------+------+------+
| ausername | busername | auid | buid |
+-----------+-----------+------+------+
| root      | root      |    0 |    0 |
| bin       | bin       |    1 |    1 |
| daemon    | daemon    |    2 |    2 |
+-----------+-----------+------+------+
3 rows in set (0.00 sec)

mysql&gt; desc v4;
+-----------+----------+------+-----+---------+-------+
| Field     | Type     | Null | Key | Default | Extra |
+-----------+----------+------+-----+---------+-------+
| ausername | char(20) | YES  |     | NULL    |       |
| busername | char(20) | YES  |     | NULL    |       |
| auid      | int(2)   | YES  |     | NULL    |       |
| buid      | int(2)   | YES  |     | NULL    |       |
+-----------+----------+------+-----+---------+-------+
4 rows in set (0.00 sec)
</pre></div></div>
      <p>3）OR REPLACE的选项使用</p>
      <p>创建时，若视图已存在，会替换已有的视图</p>
      <p>语法格式：create or replace view视图名as select 查询； //达到修改已有视图的目的</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> create  or  replace view v4 as select a<span class="sh_symbol">.</span>username as ausername<span class="sh_symbol">,</span>b<span class="sh_symbol">.</span>username as busername<span class="sh_symbol">,</span>  a<span class="sh_symbol">.</span>uid as auid<span class="sh_symbol">,</span>b<span class="sh_symbol">.</span>uid as buid  from user2 a  left join info b  on  a<span class="sh_symbol">.</span>username<span class="sh_symbol">=</span>b<span class="sh_symbol">.</span>username<span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; create  or  replace view v4 as select a.username as ausername,b.username as busername,  a.uid as auid,b.uid as buid  from user2 a  left join info b  on  a.username=b.username;
Query OK, 0 rows affected (0.00 sec)

</pre></div></div>
      <p>4）WITH  LOCAL CHECK OPTION</p>
      <p>LOCAL和CASCADED关键字决定检查的范围</p>
      <p>LOCAL 仅检查当前视图的限制</p>
      <p>CASCADED  同时要满足基表的限制（默认值）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> create table user1  select username<span class="sh_symbol">,</span>uid<span class="sh_symbol">,</span>shell from user where uid<span class="sh_symbol">&gt;=</span><span class="sh_number">5</span> and uid <span class="sh_symbol">&lt;=</span><span class="sh_number">40</span><span class="sh_symbol">;</span>  </li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">11</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.01</span> sec<span class="sh_symbol">)</span></li><li>Records<span class="sh_symbol">:</span> <span class="sh_number">11</span>  Duplicates<span class="sh_symbol">:</span> <span class="sh_number">0</span>  Warnings<span class="sh_symbol">:</span> <span class="sh_number">0</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> create view v1 as select username<span class="sh_symbol">,</span>uid from user1 where uid<span class="sh_symbol">&lt;=</span><span class="sh_number">20</span><span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.01</span> sec<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> update v1 set uid<span class="sh_symbol">=</span><span class="sh_number">21</span> where  username<span class="sh_symbol">=</span><span class="sh_string">"sync"</span><span class="sh_symbol">;</span> &nbsp;&nbsp;&nbsp;&nbsp;</li><li><span class="sh_comment">//操作超过视图表的条件限制（uid&lt;=20）之后，在视图表里面查看不到，在基表里可以查看到</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">1</span> row <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.01</span> sec<span class="sh_symbol">)</span></li><li>Rows matched<span class="sh_symbol">:</span> <span class="sh_number">1</span>  Changed<span class="sh_symbol">:</span> <span class="sh_number">1</span>  Warnings<span class="sh_symbol">:</span> <span class="sh_number">0</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> update user1 set uid<span class="sh_symbol">=</span><span class="sh_number">41</span> where  username<span class="sh_symbol">=</span><span class="sh_string">"ftp"</span><span class="sh_symbol">;</span></li><li><span class="sh_comment">//基表在超过条件限制（uid&gt;=5 and uid &lt;=40),在基表里依然可以查看到</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">1</span> row <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li>Rows matched<span class="sh_symbol">:</span> <span class="sh_number">1</span>  Changed<span class="sh_symbol">:</span> <span class="sh_number">1</span>  Warnings<span class="sh_symbol">:</span> <span class="sh_number">0</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span>  create table a select <span class="sh_symbol">*</span> from user where uid <span class="sh_symbol">&lt;</span> <span class="sh_number">10</span><span class="sh_symbol">;</span></li><li><span class="sh_comment">//快速创建一个新表a</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">7</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.01</span> sec<span class="sh_symbol">)</span></li><li>Records<span class="sh_symbol">:</span> <span class="sh_number">7</span>  Duplicates<span class="sh_symbol">:</span> <span class="sh_number">0</span>  Warnings<span class="sh_symbol">:</span> <span class="sh_number">0</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> create view v3 as select <span class="sh_symbol">*</span> from a where uid <span class="sh_symbol">&lt;</span> <span class="sh_number">10</span> <span class="sh_keyword">with</span>  check option<span class="sh_symbol">;</span></li><li><span class="sh_comment">//不写默认为CASCADED检查自己和a要满足的要求即可</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> update v3 set uid<span class="sh_symbol">=</span><span class="sh_number">9</span> where username<span class="sh_symbol">=</span><span class="sh_string">"adm"</span><span class="sh_symbol">;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//更改成功</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.01</span> sec<span class="sh_symbol">)</span></li><li>Rows matched<span class="sh_symbol">:</span> <span class="sh_number">0</span>  Changed<span class="sh_symbol">:</span> <span class="sh_number">0</span>  Warnings<span class="sh_symbol">:</span> <span class="sh_number">0</span></li><li><span style="display:none;">&nbsp;</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> create view v2 as select <span class="sh_symbol">*</span> from v1 where uid <span class="sh_symbol">&gt;=</span> <span class="sh_number">5</span> <span class="sh_keyword">with</span> local check option<span class="sh_symbol">;</span></li><li><span class="sh_comment">//满足自身v2的要求</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li>mysql<span class="sh_symbol">&gt;</span>  update v2 set uid<span class="sh_symbol">=</span><span class="sh_number">9</span> where username<span class="sh_symbol">=</span><span class="sh_string">"sync"</span><span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li>Rows matched<span class="sh_symbol">:</span> <span class="sh_number">0</span>  Changed<span class="sh_symbol">:</span> <span class="sh_number">0</span>  Warnings<span class="sh_symbol">:</span> <span class="sh_number">0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; create table user1  select username,uid,shell from user where uid&gt;=5 and uid &lt;=40;  
Query OK, 11 rows affected (0.01 sec)
Records: 11  Duplicates: 0  Warnings: 0

mysql&gt; create view v1 as select username,uid from user1 where uid&lt;=20;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; update v1 set uid=21 where  username="sync"; 	
//操作超过视图表的条件限制（uid&lt;=20）之后，在视图表里面查看不到，在基表里可以查看到
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql&gt; update user1 set uid=41 where  username="ftp";
//基表在超过条件限制（uid&gt;=5 and uid &lt;=40),在基表里依然可以查看到
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql&gt;  create table a select * from user where uid &lt; 10;
//快速创建一个新表a
Query OK, 7 rows affected (0.01 sec)
Records: 7  Duplicates: 0  Warnings: 0

mysql&gt; create view v3 as select * from a where uid &lt; 10 with  check option;
//不写默认为CASCADED检查自己和a要满足的要求即可
Query OK, 0 rows affected (0.00 sec)

mysql&gt; update v3 set uid=9 where username="adm";	//更改成功
Query OK, 0 rows affected (0.01 sec)
Rows matched: 0  Changed: 0  Warnings: 0


mysql&gt; create view v2 as select * from v1 where uid &gt;= 5 with local check option;
//满足自身v2的要求
Query OK, 0 rows affected (0.00 sec)
mysql&gt;  update v2 set uid=9 where username="sync";
Query OK, 0 rows affected (0.00 sec)
Rows matched: 0  Changed: 0  Warnings: 0
</pre></div></div>
      <p>5）WITH  CASCADED CHECK OPTION</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/DBA2/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span>  create view v5 as select <span class="sh_symbol">*</span> from v1 where uid <span class="sh_symbol">&gt;=</span> <span class="sh_number">5</span> <span class="sh_keyword">with</span> cascaded check option<span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt;  create view v5 as select * from v1 where uid &gt;= 5 with cascaded check option;
Query OK, 0 rows affected (0.00 sec)
</pre></div></div>
    </div>
  
</body></html>