
<!-- saved from url=(0074)http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>CASE</title>
    
    <script type="text/javascript" src="./6CASE_files/jquery.min.js">
    </script>
    <script type="text/javascript" src="./6CASE_files/jquery.snippet.js">
    </script>
    <script type="text/javascript" src="./6CASE_files/main.js">
    </script>
    <link type="text/css" href="./6CASE_files/index.css" rel="Stylesheet">
    <link type="text/css" href="./6CASE_files/jquery.snippet.css" rel="Stylesheet">
  </head>
  <body>
    <div class="source_style_case">
      <a name="page_top_case" id="top_anchor">
      </a><a id="link_top" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#page_top_case">Top</a>
      <h1>NSD CLOUD DAY06</h1>
      <ol class="index">
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#case1">案例1：安装Docker</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#case2">案例2：镜像基本操作</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#case3">案例3：镜像与容器常用指令</a>
        </li>
      </ol>
      <a name="case1">
      </a>
      <h2>1 案例1：安装Docker</h2>
      <h3>1.1 问题</h3>
      <p>本案例要求配置yum源并安装Docker：</p>
      <ul class="list">
        <li>准备两台虚拟机，IP为192.168.1.10和192.168.1.20
</li>
        <li>安装docker-engine 和 docker-engine-selinux
</li>
        <li>关闭防火墙
</li>
      </ul>
      <h3>1.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：配置yum源</p>
      <p>1）配置第三方yum源（真机操作）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style=""><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">mkdir </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/ftp/</span>docker</li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># mv docker<span class="sh_symbol">-</span>engine<span class="sh_symbol">-*</span> <span class="sh_regexp">/var/</span><span class="sh_normal">ftp</span><span class="sh_symbol">/</span>docker</li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">ls </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/ftp/</span>docker</li><li>docker<span class="sh_symbol">-</span>engine<span class="sh_number">-1.12.1-1</span><span class="sh_symbol">.</span>el7<span class="sh_symbol">.</span>centos<span class="sh_symbol">.</span>x86_64<span class="sh_symbol">.</span>rpm</li><li>docker<span class="sh_symbol">-</span>engine<span class="sh_symbol">-</span>selinux<span class="sh_number">-1.12.1-1</span><span class="sh_symbol">.</span>el7<span class="sh_symbol">.</span>centos<span class="sh_symbol">.</span>noarch<span class="sh_symbol">.</span>rpm</li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">createrepo </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/ftp/</span><span class="sh_normal">docker</span><span class="sh_symbol">/</span></li><li>Spawning worker <span class="sh_number">0</span> <span class="sh_keyword">with</span> <span class="sh_number">1</span> pkgs</li><li>Spawning worker <span class="sh_number">1</span> <span class="sh_keyword">with</span> <span class="sh_number">1</span> pkgs</li><li>Spawning worker <span class="sh_number">2</span> <span class="sh_keyword">with</span> <span class="sh_number">0</span> pkgs</li><li>Spawning worker <span class="sh_number">3</span> <span class="sh_keyword">with</span> <span class="sh_number">0</span> pkgs</li><li>Spawning worker <span class="sh_number">4</span> <span class="sh_keyword">with</span> <span class="sh_number">0</span> pkgs</li><li>Spawning worker <span class="sh_number">5</span> <span class="sh_keyword">with</span> <span class="sh_number">0</span> pkgs</li><li>Workers Finished</li><li>Saving Primary metadata</li><li>Saving file lists metadata</li><li>Saving other metadata</li><li>Generating sqlite DBs</li><li>Sqlite DBs complete</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# mkdir /var/ftp/docker
[root@room9pc01 ~]# mv docker-engine-* /var/ftp/docker
[root@room9pc01 ~]# ls /var/ftp/docker
docker-engine-1.12.1-1.el7.centos.x86_64.rpm
docker-engine-selinux-1.12.1-1.el7.centos.noarch.rpm
[root@room9pc01 ~]# createrepo /var/ftp/docker/
Spawning worker 0 with 1 pkgs
Spawning worker 1 with 1 pkgs
Spawning worker 2 with 0 pkgs
Spawning worker 3 with 0 pkgs
Spawning worker 4 with 0 pkgs
Spawning worker 5 with 0 pkgs
Workers Finished
Saving Primary metadata
Saving file lists metadata
Saving other metadata
Generating sqlite DBs
Sqlite DBs complete

</pre></div></div>
      <p>2）配置IP（虚拟机配置静态ip）docker1和docker2主机同样操作</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># echo docker1 <span class="sh_symbol">&gt;</span> <span class="sh_regexp">/etc/</span>hostname </li><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># hostname docker1</li><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># echo docker2 <span class="sh_symbol">&gt;</span> <span class="sh_regexp">/etc/</span>hostname </li><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># hostname docker2</li><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">sysconfig</span><span class="sh_symbol">/</span>network<span class="sh_symbol">-</span><span class="sh_normal">scripts</span><span class="sh_symbol">/</span>ifcfg<span class="sh_symbol">-</span>eth0</li><li># Generated by dracut initrd</li><li>DEVICE<span class="sh_symbol">=</span><span class="sh_string">"eth0"</span></li><li>ONBOOT<span class="sh_symbol">=</span><span class="sh_string">"yes"</span></li><li>IPV6INIT<span class="sh_symbol">=</span><span class="sh_string">"no"</span></li><li>IPV4_FAILURE_FATAL<span class="sh_symbol">=</span><span class="sh_string">"no"</span></li><li>NM_CONTROLLED<span class="sh_symbol">=</span><span class="sh_string">"no"</span></li><li>TYPE<span class="sh_symbol">=</span><span class="sh_string">"Ethernet"</span></li><li>BOOTPROTO<span class="sh_symbol">=</span><span class="sh_string">"static"</span></li><li>IPADDR<span class="sh_symbol">=</span><span class="sh_string">"192.168.1.10"</span></li><li>PREFIX<span class="sh_symbol">=</span><span class="sh_number">24</span></li><li>GATEWAY<span class="sh_symbol">=</span><span class="sh_number">192.168.1.254</span></li><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># systemctl restart network</li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">[</span>root@docker2 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">sysconfig</span><span class="sh_symbol">/</span>network<span class="sh_symbol">-</span><span class="sh_normal">scripts</span><span class="sh_symbol">/</span>ifcfg<span class="sh_symbol">-</span>eth0</li><li># Generated by dracut initrd</li><li>DEVICE<span class="sh_symbol">=</span><span class="sh_string">"eth0"</span></li><li>ONBOOT<span class="sh_symbol">=</span><span class="sh_string">"yes"</span></li><li>IPV6INIT<span class="sh_symbol">=</span><span class="sh_string">"no"</span></li><li>IPV4_FAILURE_FATAL<span class="sh_symbol">=</span><span class="sh_string">"no"</span></li><li>NM_CONTROLLED<span class="sh_symbol">=</span><span class="sh_string">"no"</span></li><li>TYPE<span class="sh_symbol">=</span><span class="sh_string">"Ethernet"</span></li><li>BOOTPROTO<span class="sh_symbol">=</span><span class="sh_string">"static"</span></li><li>IPADDR<span class="sh_symbol">=</span><span class="sh_string">"192.168.1.20"</span></li><li>PREFIX<span class="sh_symbol">=</span><span class="sh_number">24</span></li><li>GATEWAY<span class="sh_symbol">=</span><span class="sh_number">192.168.1.254</span></li><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># systemctl restart network</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@localhost ~]# echo docker1 &gt; /etc/hostname 
[root@localhost ~]# hostname docker1
[root@localhost ~]# echo docker2 &gt; /etc/hostname 
[root@localhost ~]# hostname docker2
[root@docker1 ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth0
# Generated by dracut initrd
DEVICE="eth0"
ONBOOT="yes"
IPV6INIT="no"
IPV4_FAILURE_FATAL="no"
NM_CONTROLLED="no"
TYPE="Ethernet"
BOOTPROTO="static"
IPADDR="192.168.1.10"
PREFIX=24
GATEWAY=192.168.1.254
[root@docker1 ~]# systemctl restart network

[root@docker2 ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth0
# Generated by dracut initrd
DEVICE="eth0"
ONBOOT="yes"
IPV6INIT="no"
IPV4_FAILURE_FATAL="no"
NM_CONTROLLED="no"
TYPE="Ethernet"
BOOTPROTO="static"
IPADDR="192.168.1.20"
PREFIX=24
GATEWAY=192.168.1.254
[root@docker1 ~]# systemctl restart network

</pre></div></div>
      <p>3）配置yum客户端（docker1和docker2主机同样操作）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>yum<span class="sh_symbol">.</span>repos<span class="sh_symbol">.</span><span class="sh_normal">d</span><span class="sh_symbol">/</span>local<span class="sh_symbol">.</span>repo </li><li><span class="sh_symbol">[</span>local_repo<span class="sh_symbol">]</span></li><li>name<span class="sh_symbol">=</span>CentOS<span class="sh_symbol">-</span>$releasever <span class="sh_symbol">-</span> Base</li><li>baseurl<span class="sh_symbol">=</span><span class="sh_string">"ftp://192.168.1.254/system"</span></li><li>enabled<span class="sh_symbol">=</span><span class="sh_number">1</span></li><li>gpgcheck<span class="sh_symbol">=</span><span class="sh_number">1</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">[</span>loca<span class="sh_symbol">]</span></li><li>name<span class="sh_symbol">=</span>local</li><li>baseurl<span class="sh_symbol">=</span><span class="sh_string">"ftp://192.168.1.254/docker"</span></li><li>enabled<span class="sh_symbol">=</span><span class="sh_number">1</span></li><li>gpgcheck<span class="sh_symbol">=</span><span class="sh_number">0</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">[</span>root@docker2 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>yum<span class="sh_symbol">.</span>repos<span class="sh_symbol">.</span><span class="sh_normal">d</span><span class="sh_symbol">/</span>local<span class="sh_symbol">.</span>repo </li><li><span class="sh_symbol">[</span>local_repo<span class="sh_symbol">]</span></li><li>name<span class="sh_symbol">=</span>CentOS<span class="sh_symbol">-</span>$releasever <span class="sh_symbol">-</span> Base</li><li>baseurl<span class="sh_symbol">=</span><span class="sh_string">"ftp://192.168.1.254/system"</span></li><li>enabled<span class="sh_symbol">=</span><span class="sh_number">1</span></li><li>gpgcheck<span class="sh_symbol">=</span><span class="sh_number">1</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">[</span>loca<span class="sh_symbol">]</span></li><li>name<span class="sh_symbol">=</span>local</li><li>baseurl<span class="sh_symbol">=</span><span class="sh_string">"ftp://192.168.1.254/docker"</span></li><li>enabled<span class="sh_symbol">=</span><span class="sh_number">1</span></li><li>gpgcheck<span class="sh_symbol">=</span><span class="sh_number">0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 ~]# vim /etc/yum.repos.d/local.repo 
[local_repo]
name=CentOS-$releasever - Base
baseurl="ftp://192.168.1.254/system"
enabled=1
gpgcheck=1

[loca]
name=local
baseurl="ftp://192.168.1.254/docker"
enabled=1
gpgcheck=0

[root@docker2 ~]# vim /etc/yum.repos.d/local.repo 
[local_repo]
name=CentOS-$releasever - Base
baseurl="ftp://192.168.1.254/system"
enabled=1
gpgcheck=1

[loca]
name=local
baseurl="ftp://192.168.1.254/docker"
enabled=1
gpgcheck=0

</pre></div></div>
      <p>4）安装docker（docker1和docker2主机同样操作）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install docker<span class="sh_symbol">-</span>engine</li><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># systemctl restart docker</li><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># systemctl enable docker</li><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># ifconfig &nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//有docker0说明环境部署完成</span></li><li>docker0<span class="sh_symbol">:</span> flags<span class="sh_symbol">=</span><span class="sh_number">4099</span><span class="sh_symbol">&lt;</span>UP<span class="sh_symbol">,</span>BROADCAST<span class="sh_symbol">,</span>MULTICAST<span class="sh_symbol">&gt;</span>  mtu <span class="sh_number">1500</span></li><li>        inet <span class="sh_number">172.17.0.1</span>  netmask <span class="sh_number">255.255.0.0</span>  broadcast <span class="sh_number">0.0.0.0</span></li><li>        ether <span class="sh_number">02</span><span class="sh_symbol">:</span><span class="sh_number">42</span><span class="sh_symbol">:</span>3e<span class="sh_symbol">:</span>e7<span class="sh_symbol">:</span>3f<span class="sh_symbol">:</span>6e  txqueuelen <span class="sh_number">0</span>  <span class="sh_symbol">(</span>Ethernet<span class="sh_symbol">)</span></li><li>        RX packets <span class="sh_number">0</span>  bytes <span class="sh_number">0</span> <span class="sh_symbol">(</span><span class="sh_number">0.0</span> B<span class="sh_symbol">)</span></li><li>        RX errors <span class="sh_number">0</span>  dropped <span class="sh_number">0</span>  overruns <span class="sh_number">0</span>  frame <span class="sh_number">0</span></li><li>        TX packets <span class="sh_number">0</span>  bytes <span class="sh_number">0</span> <span class="sh_symbol">(</span><span class="sh_number">0.0</span> B<span class="sh_symbol">)</span></li><li>        TX errors <span class="sh_number">0</span>  dropped <span class="sh_number">0</span> overruns <span class="sh_number">0</span>  carrier <span class="sh_number">0</span>  collisions <span class="sh_number">0</span></li><li><span class="sh_symbol">[</span>root@docker2 <span class="sh_symbol">~]</span># docker version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//查看版本</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">[</span>root@docker2 <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install docker<span class="sh_symbol">-</span>engine</li><li><span class="sh_symbol">[</span>root@docker2 <span class="sh_symbol">~]</span># systemctl restart docker</li><li><span class="sh_symbol">[</span>root@docker2 <span class="sh_symbol">~]</span># systemctl enable docker</li><li><span class="sh_symbol">[</span>root@docker2 <span class="sh_symbol">~]</span># ifconfig &nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//有docker0说明环境部署完成</span></li><li>docker0<span class="sh_symbol">:</span> flags<span class="sh_symbol">=</span><span class="sh_number">4099</span><span class="sh_symbol">&lt;</span>UP<span class="sh_symbol">,</span>BROADCAST<span class="sh_symbol">,</span>MULTICAST<span class="sh_symbol">&gt;</span>  mtu <span class="sh_number">1500</span></li><li>        inet <span class="sh_number">172.17.0.1</span>  netmask <span class="sh_number">255.255.0.0</span>  broadcast <span class="sh_number">0.0.0.0</span></li><li>        ether <span class="sh_number">02</span><span class="sh_symbol">:</span><span class="sh_number">42</span><span class="sh_symbol">:</span><span class="sh_number">53</span><span class="sh_symbol">:</span><span class="sh_number">82</span><span class="sh_symbol">:</span>b9<span class="sh_symbol">:</span>d4  txqueuelen <span class="sh_number">0</span>  <span class="sh_symbol">(</span>Ethernet<span class="sh_symbol">)</span></li><li>        RX packets <span class="sh_number">0</span>  bytes <span class="sh_number">0</span> <span class="sh_symbol">(</span><span class="sh_number">0.0</span> B<span class="sh_symbol">)</span></li><li>        RX errors <span class="sh_number">0</span>  dropped <span class="sh_number">0</span>  overruns <span class="sh_number">0</span>  frame <span class="sh_number">0</span></li><li>        TX packets <span class="sh_number">0</span>  bytes <span class="sh_number">0</span> <span class="sh_symbol">(</span><span class="sh_number">0.0</span> B<span class="sh_symbol">)</span></li><li>        TX errors <span class="sh_number">0</span>  dropped <span class="sh_number">0</span> overruns <span class="sh_number">0</span>  carrier <span class="sh_number">0</span>  collisions <span class="sh_number">0</span></li><li><span class="sh_symbol">[</span>root@docker2 <span class="sh_symbol">~]</span># docker version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//查看版本</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 ~]# yum -y install docker-engine
[root@docker1 ~]# systemctl restart docker
[root@docker1 ~]# systemctl enable docker
[root@docker1 ~]# ifconfig 	//有docker0说明环境部署完成
docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
        inet 172.17.0.1  netmask 255.255.0.0  broadcast 0.0.0.0
        ether 02:42:3e:e7:3f:6e  txqueuelen 0  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
[root@docker2 ~]# docker version		//查看版本

[root@docker2 ~]# yum -y install docker-engine
[root@docker2 ~]# systemctl restart docker
[root@docker2 ~]# systemctl enable docker
[root@docker2 ~]# ifconfig 	//有docker0说明环境部署完成
docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
        inet 172.17.0.1  netmask 255.255.0.0  broadcast 0.0.0.0
        ether 02:42:53:82:b9:d4  txqueuelen 0  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
[root@docker2 ~]# docker version		//查看版本

</pre></div></div>
      <a name="case2">
      </a>
      <h2>2 案例2：镜像基本操作</h2>
      <h3>2.1 问题</h3>
      <p>本案例要求熟悉镜像的基本操作：</p>
      <ul class="list">
        <li>导入镜像
</li>
        <li>导出镜像
</li>
        <li>启动镜像
</li>
      </ul>
      <h3>2.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：docker镜像</p>
      <p>1）下载镜像</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># docker pull busybox</li><li>Using <span class="sh_keyword">default</span> tag<span class="sh_symbol">:</span> latest</li><li>latest<span class="sh_symbol">:</span> Pulling from <span class="sh_normal">library</span><span class="sh_symbol">/</span>busybox</li><li>8c5a7da1afbc<span class="sh_symbol">:</span> Pull complete </li><li>Digest<span class="sh_symbol">:</span> sha256<span class="sh_symbol">:</span>cb63aa0641a885f54de20f61d152187419e8f6b159ed11a251a09d115fdff9bd</li><li>Status<span class="sh_symbol">:</span> Downloaded newer image <span class="sh_keyword">for</span> busybox<span class="sh_symbol">:</span>latest</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 ~]# docker pull busybox
Using default tag: latest
latest: Pulling from library/busybox
8c5a7da1afbc: Pull complete 
Digest: sha256:cb63aa0641a885f54de20f61d152187419e8f6b159ed11a251a09d115fdff9bd
Status: Downloaded newer image for busybox:latest
</pre></div></div>
      <p>2）上传镜像</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># docker push busybox</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 ~]# docker push busybox
</pre></div></div>
      <p>3）查看镜像</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># docker images</li><li>REPOSITORY        TAG               IMAGE ID          CREATED           SIZE</li><li>busybox           latest            e1ddd7948a1c      <span class="sh_number">4</span> weeks ago       <span class="sh_number">1.163</span> MB</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 ~]# docker images
REPOSITORY        TAG               IMAGE ID          CREATED           SIZE
busybox           latest            e1ddd7948a1c      4 weeks ago       1.163 MB
</pre></div></div>
      <p>4）查找busybox镜像</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># docker search busybox</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 ~]# docker search busybox
</pre></div></div>
      <p>5）导出busybox镜像为busybox.tar</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># docker  save  busybox<span class="sh_symbol">:</span>latest <span class="sh_symbol">&gt;</span>busybox<span class="sh_symbol">.</span>tar</li><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># ls</li><li>busybox<span class="sh_symbol">.</span>tar  </li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 ~]# docker  save  busybox:latest &gt;busybox.tar
[root@docker1 ~]# ls
busybox.tar  
</pre></div></div>
      <p>6）导入镜像</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># scp  busybox<span class="sh_symbol">.</span>tar <span class="sh_number">192.168.1.20</span><span class="sh_symbol">:/</span>root</li><li><span class="sh_symbol">[</span>root@docker2 <span class="sh_symbol">~]</span># ls</li><li>busybox<span class="sh_symbol">.</span>tar  </li><li><span class="sh_symbol">[</span>root@docker2 <span class="sh_symbol">~]</span># docker load <span class="sh_symbol">&lt;</span>busybox<span class="sh_symbol">.</span>tar</li><li>f9d9e4e6e2f0<span class="sh_symbol">:</span> Loading layer <span class="sh_symbol">[==================================================&gt;]</span> <span class="sh_number">1.378</span> <span class="sh_normal">MB</span><span class="sh_symbol">/</span><span class="sh_number">1.378</span> MB</li><li>Loaded image<span class="sh_symbol">:</span> busybox<span class="sh_symbol">:</span>latest<span class="sh_symbol">[=&gt;</span>                                                 <span class="sh_symbol">]</span> <span class="sh_number">32.77</span> <span class="sh_normal">kB</span><span class="sh_symbol">/</span><span class="sh_number">1.378</span> MB</li><li><span class="sh_symbol">[</span>root@docker2 <span class="sh_symbol">~]</span># docker images</li><li>REPOSITORY          TAG                 IMAGE ID            CREATED           SIZE</li><li>busybox             latest              e1ddd7948a1c        <span class="sh_number">4</span> weeks ago      <span class="sh_number">1.163</span> MB</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 ~]# scp  busybox.tar 192.168.1.20:/root
[root@docker2 ~]# ls
busybox.tar  
[root@docker2 ~]# docker load &lt;busybox.tar
f9d9e4e6e2f0: Loading layer [==================================================&gt;] 1.378 MB/1.378 MB
Loaded image: busybox:latest[=&gt;                                                 ] 32.77 kB/1.378 MB
[root@docker2 ~]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED           SIZE
busybox             latest              e1ddd7948a1c        4 weeks ago      1.163 MB
</pre></div></div>
      <p>7）删除镜像</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker2 <span class="sh_symbol">~]</span># docker rmi  busybox</li><li>Untagged<span class="sh_symbol">:</span> busybox<span class="sh_symbol">:</span>latest</li><li>Deleted<span class="sh_symbol">:</span> sha256<span class="sh_symbol">:</span>e1ddd7948a1c31709a23cc5b7dfe96e55fc364f90e1cebcde0773a1b5a30dcda</li><li>Deleted<span class="sh_symbol">:</span> sha256<span class="sh_symbol">:</span>f9d9e4e6e2f0689cd752390e14ade48b0ec6f2a488a05af5ab2f9ccaf54c299d</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker2 ~]# docker rmi  busybox
Untagged: busybox:latest
Deleted: sha256:e1ddd7948a1c31709a23cc5b7dfe96e55fc364f90e1cebcde0773a1b5a30dcda
Deleted: sha256:f9d9e4e6e2f0689cd752390e14ade48b0ec6f2a488a05af5ab2f9ccaf54c299d
</pre></div></div>
      <p class="number">步骤二：一次性导入多个镜像</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install unzip</li><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># unzip docker_images<span class="sh_symbol">.</span>zip </li><li>Archive<span class="sh_symbol">:</span>  docker_images<span class="sh_symbol">.</span>zip</li><li>   creating<span class="sh_symbol">:</span> <span class="sh_normal">docker_images</span><span class="sh_symbol">/</span></li><li>  inflating<span class="sh_symbol">:</span> <span class="sh_normal">docker_images</span><span class="sh_symbol">/</span>nginx<span class="sh_symbol">.</span>tar  </li><li>  inflating<span class="sh_symbol">:</span> <span class="sh_normal">docker_images</span><span class="sh_symbol">/</span>redis<span class="sh_symbol">.</span>tar  </li><li>  inflating<span class="sh_symbol">:</span> <span class="sh_normal">docker_images</span><span class="sh_symbol">/</span>centos<span class="sh_symbol">.</span>tar  </li><li>  inflating<span class="sh_symbol">:</span> <span class="sh_normal">docker_images</span><span class="sh_symbol">/</span>registry<span class="sh_symbol">.</span>tar  </li><li>  inflating<span class="sh_symbol">:</span> <span class="sh_normal">docker_images</span><span class="sh_symbol">/</span>ubuntu<span class="sh_symbol">.</span>tar</li><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># ls</li><li>busybox<span class="sh_symbol">.</span>tar  docker_images  docker_images<span class="sh_symbol">.</span>zip  eip</li><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># cd docker_images</li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># ls</li><li>centos<span class="sh_symbol">.</span>tar  nginx<span class="sh_symbol">.</span>tar  redis<span class="sh_symbol">.</span>tar  registry<span class="sh_symbol">.</span>tar  ubuntu<span class="sh_symbol">.</span>tar</li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker images</li><li>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</li><li>busybox             latest              e1ddd7948a1c        <span class="sh_number">4</span> weeks ago         <span class="sh_number">1.163</span> MB</li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># <span class="sh_keyword">for</span> i <span class="sh_keyword">in</span> <span class="sh_symbol">*;</span> <span class="sh_keyword">do</span> docker load <span class="sh_symbol">&lt;</span>$i<span class="sh_symbol">;</span> done</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 ~]# yum -y install unzip
[root@docker1 ~]# unzip docker_images.zip 
Archive:  docker_images.zip
   creating: docker_images/
  inflating: docker_images/nginx.tar  
  inflating: docker_images/redis.tar  
  inflating: docker_images/centos.tar  
  inflating: docker_images/registry.tar  
  inflating: docker_images/ubuntu.tar
[root@docker1 ~]# ls
busybox.tar  docker_images  docker_images.zip  eip
[root@docker1 ~]# cd docker_images
[root@docker1 docker_images]# ls
centos.tar  nginx.tar  redis.tar  registry.tar  ubuntu.tar
[root@docker1 docker_images]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
busybox             latest              e1ddd7948a1c        4 weeks ago         1.163 MB
[root@docker1 docker_images]# for i in *; do docker load &lt;$i; done
</pre></div></div>
      <p>导入多个镜像如图-1所示：</p>
      <div class="image">
        <img src="./6CASE_files/image001.png">
        <p>图-1</p>
      </div>
      <p class="number">步骤三：启动镜像</p>
      <p>1）启动centos镜像生成一个容器</p>
      <p>启动镜像时若不知道后面的命令加什么:</p>
      <p>1、可以猜（如：/bin/bash、/bin/sh）</p>
      <p>2、可以不加后面的命令，默认启动</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker run <span class="sh_symbol">-</span>it <span class="sh_normal">centos </span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>bash</li><li><span class="sh_symbol">[</span>root@7<span class="sh_normal">a652fc72a9f </span><span class="sh_symbol">/]</span># <span class="sh_normal">ls </span><span class="sh_symbol">/</span></li><li>anaconda<span class="sh_symbol">-</span>post<span class="sh_symbol">.</span>log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  <span class="sh_keyword">var</span></li><li><span class="sh_symbol">[</span>root@7<span class="sh_normal">a652fc72a9f </span><span class="sh_symbol">/]</span># <span class="sh_normal">cd </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>yum<span class="sh_symbol">.</span>repos<span class="sh_symbol">.</span><span class="sh_normal">d</span><span class="sh_symbol">/</span></li><li><span class="sh_symbol">[</span>root@7a652fc72a9f yum<span class="sh_symbol">.</span>repos<span class="sh_symbol">.</span>d<span class="sh_symbol">]</span># ls</li><li>CentOS<span class="sh_symbol">-</span>Base<span class="sh_symbol">.</span>repo  CentOS<span class="sh_symbol">-</span>Debuginfo<span class="sh_symbol">.</span>repo  CentOS<span class="sh_symbol">-</span>Sources<span class="sh_symbol">.</span>repo  CentOS<span class="sh_symbol">-</span>fasttrack<span class="sh_symbol">.</span>repo</li><li>CentOS<span class="sh_symbol">-</span>CR<span class="sh_symbol">.</span>repo    CentOS<span class="sh_symbol">-</span>Media<span class="sh_symbol">.</span>repo      CentOS<span class="sh_symbol">-</span>Vault<span class="sh_symbol">.</span>repo</li><li><span class="sh_symbol">[</span>root@7a652fc72a9f yum<span class="sh_symbol">.</span>repos<span class="sh_symbol">.</span>d<span class="sh_symbol">]</span># rm <span class="sh_symbol">-</span>rf C<span class="sh_symbol">*</span></li><li><span class="sh_symbol">[</span>root@7a652fc72a9f yum<span class="sh_symbol">.</span>repos<span class="sh_symbol">.</span>d<span class="sh_symbol">]</span># ls</li><li><span class="sh_symbol">[</span>root@7a652fc72a9f yum<span class="sh_symbol">.</span>repos<span class="sh_symbol">.</span>d<span class="sh_symbol">]</span>#vi dvd<span class="sh_symbol">.</span>repo    <span class="sh_comment">//在容器里面配置一个yum源</span></li><li><span class="sh_symbol">[</span>local<span class="sh_symbol">]</span></li><li>name<span class="sh_symbol">=</span>local</li><li>baseurl<span class="sh_symbol">=</span>ftp<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.254/system</span></li><li>enable<span class="sh_symbol">=</span><span class="sh_number">1</span></li><li>gpgcheck<span class="sh_symbol">=</span><span class="sh_number">0</span></li><li><span class="sh_symbol">[</span>root@7a652fc72a9f yum<span class="sh_symbol">.</span>repos<span class="sh_symbol">.</span>d<span class="sh_symbol">]</span># yum <span class="sh_symbol">-</span>y install net<span class="sh_symbol">-</span>tools  <span class="sh_comment">//安装软件</span></li><li><span class="sh_symbol">[</span>root@7a652fc72a9f yum<span class="sh_symbol">.</span>repos<span class="sh_symbol">.</span>d<span class="sh_symbol">]</span># exit</li><li>exit</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 docker_images]# docker run -it centos /bin/bash
[root@7a652fc72a9f /]# ls /
anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
[root@7a652fc72a9f /]# cd /etc/yum.repos.d/
[root@7a652fc72a9f yum.repos.d]# ls
CentOS-Base.repo  CentOS-Debuginfo.repo  CentOS-Sources.repo  CentOS-fasttrack.repo
CentOS-CR.repo    CentOS-Media.repo      CentOS-Vault.repo
[root@7a652fc72a9f yum.repos.d]# rm -rf C*
[root@7a652fc72a9f yum.repos.d]# ls
[root@7a652fc72a9f yum.repos.d]#vi dvd.repo    //在容器里面配置一个yum源
[local]
name=local
baseurl=ftp://192.168.1.254/system
enable=1
gpgcheck=0
[root@7a652fc72a9f yum.repos.d]# yum -y install net-tools  //安装软件
[root@7a652fc72a9f yum.repos.d]# exit
exit
</pre></div></div>
      <a name="case3">
      </a>
      <h2>3 案例3：镜像与容器常用指令</h2>
      <h3>3.1 问题</h3>
      <p>本案例要求掌握镜像与容器的常用命令：</p>
      <ul class="list">
        <li>镜像常用指令练习
</li>
        <li>容器常用指令练习
</li>
      </ul>
      <h3>3.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：镜像常用命令</p>
      <p>1）查看后台运行的容器</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># docker run <span class="sh_symbol">-</span>d nginx  <span class="sh_comment">//启动nginx的镜像</span></li><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># docker ps&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//查看后台运行的容器</span></li><li>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</li><li>56ec8154f8e0        nginx<span class="sh_symbol">:</span>latest        <span class="sh_string">"nginx -g 'daemon off"</span>   <span class="sh_number">17</span> minutes ago      Up <span class="sh_number">12</span> minutes       <span class="sh_number">80</span><span class="sh_symbol">/</span>tcp<span class="sh_symbol">,</span> <span class="sh_number">443</span><span class="sh_symbol">/</span>tcp     zen_darwin</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 ~]# docker run -d nginx  //启动nginx的镜像
[root@docker1 ~]# docker ps	//查看后台运行的容器
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
56ec8154f8e0        nginx:latest        "nginx -g 'daemon off"   17 minutes ago      Up 12 minutes       80/tcp, 443/tcp     zen_darwin
</pre></div></div>
      <p>2）只显示容器ID</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker ps <span class="sh_symbol">-</span>q</li><li>56ec8154f8e0</li><li>85c6b0b62235</li><li>f7ee40a87af5</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 docker_images]# docker ps -q
56ec8154f8e0
85c6b0b62235
f7ee40a87af5
</pre></div></div>
      <p>3）显示所有的容器,包括没有启动的</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li> <span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker ps <span class="sh_symbol">-</span>a</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;"> [root@docker1 docker_images]# docker ps -a
</pre></div></div>
      <p>4）显示所有的容器ID</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker ps <span class="sh_symbol">-</span>qa</li><li>56ec8154f8e0</li><li>2b68c3960737</li><li>85c6b0b62235</li><li>f7ee40a87af5</li><li>b261be571648</li><li>fb2fb8c3d7a8</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 docker_images]# docker ps -qa
56ec8154f8e0
2b68c3960737
85c6b0b62235
f7ee40a87af5
b261be571648
fb2fb8c3d7a8
</pre></div></div>
      <p>5）查看centos镜像历史（制作过程），如图-2所示：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li> <span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker history centos</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;"> [root@docker1 docker_images]# docker history centos
</pre></div></div>
      <div class="image">
        <img src="./6CASE_files/image002.png">
        <p>图-2</p>
      </div>
      <p>7）删除镜像，启动容器时删除镜像会失败，先删除容器,再删除镜像</p>
      <p>格式：docker rmi  镜像名</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker rmi nginx  <span class="sh_comment">//nginx为镜像名</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_predef_func">Error</span> response from daemon<span class="sh_symbol">:</span> conflict<span class="sh_symbol">:</span> unable to remove repository reference <span class="sh_string">"nginx"</span> <span class="sh_symbol">(</span>must force<span class="sh_symbol">)</span> <span class="sh_symbol">-</span> container 4f83871aa42e is using its referenced image a5311a310510 <span class="sh_comment">//删除时报错</span></li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker stop 4f</li><li>4f</li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker rm 4f</li><li>4f</li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker rmi nginx   <span class="sh_comment">//成功删除</span></li><li>Untagged<span class="sh_symbol">:</span> nginx<span class="sh_symbol">:</span>latest</li><li>Deleted<span class="sh_symbol">:</span> sha256<span class="sh_symbol">:</span>d1fd7d86a8257f3404f92c4474fb3353076883062d64a09232d95d940627459d</li><li>Deleted<span class="sh_symbol">:</span> sha256<span class="sh_symbol">:</span>4d765aea84ce4f56bd623e4fd38dec996a259af3418e2466d0e2067ed0ae8aa6</li><li>Deleted<span class="sh_symbol">:</span> sha256<span class="sh_symbol">:</span>5d385be69c9c4ce5538e12e6e677727ebf19ca0afaff6f035d8043b5e413003a</li><li>Deleted<span class="sh_symbol">:</span> sha256<span class="sh_symbol">:</span>adb712878b60bd7ed8ce661c91eb3ac30f41b67bfafed321395863051596a8e9</li><li>Deleted<span class="sh_symbol">:</span> sha256<span class="sh_symbol">:</span>55a50a618c1b76f784b0b68a0b3d70db93b353fb03227ea6bd87f794cad92917</li><li>Deleted<span class="sh_symbol">:</span> sha256<span class="sh_symbol">:</span>e53f74215d12318372e4412d0f0eb3908e17db25c6185f670db49aef5271f91f</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 docker_images]# docker rmi nginx  //nginx为镜像名

Error response from daemon: conflict: unable to remove repository reference "nginx" (must force) - container 4f83871aa42e is using its referenced image a5311a310510 //删除时报错
[root@docker1 docker_images]# docker stop 4f
4f
[root@docker1 docker_images]# docker rm 4f
4f
[root@docker1 docker_images]# docker rmi nginx   //成功删除
Untagged: nginx:latest
Deleted: sha256:d1fd7d86a8257f3404f92c4474fb3353076883062d64a09232d95d940627459d
Deleted: sha256:4d765aea84ce4f56bd623e4fd38dec996a259af3418e2466d0e2067ed0ae8aa6
Deleted: sha256:5d385be69c9c4ce5538e12e6e677727ebf19ca0afaff6f035d8043b5e413003a
Deleted: sha256:adb712878b60bd7ed8ce661c91eb3ac30f41b67bfafed321395863051596a8e9
Deleted: sha256:55a50a618c1b76f784b0b68a0b3d70db93b353fb03227ea6bd87f794cad92917
Deleted: sha256:e53f74215d12318372e4412d0f0eb3908e17db25c6185f670db49aef5271f91f
</pre></div></div>
      <p>8）修改镜像的名称和标签,默认标签为latest</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li> <span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker tag  centos<span class="sh_symbol">:</span>latest cen<span class="sh_symbol">:</span>v1</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;"> [root@docker1 docker_images]# docker tag  centos:latest cen:v1
</pre></div></div>
      <p>9）查看镜像的底层信息，如图-3所示：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker inspect centos</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 docker_images]# docker inspect centos
</pre></div></div>
      <div class="image">
        <img src="./6CASE_files/image003.png">
        <p>图-3</p>
      </div>
      <p>10）修改镜像的标签</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker tag  centos<span class="sh_symbol">:</span>latest cen<span class="sh_symbol">:</span>v1 </li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker images</li><li>REPOSITORY   TAG            IMAGE ID          CREATED          SIZE</li><li>        cen        v1             e934aafc2206   <span class="sh_number">5</span> months ago    <span class="sh_number">198.6</span> MB </li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker rmi centos    <span class="sh_comment">//删除centos</span></li><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># docker run <span class="sh_symbol">-</span>it centos   </li><li><span class="sh_comment">//启动的时候，因为是用标签标签启动的，所以会重新通过ID下载</span></li><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># docker run <span class="sh_symbol">-</span>it centos</li><li>Unable to find image <span class="sh_string">'centos:latest'</span> locally</li><li>latest<span class="sh_symbol">:</span> Pulling from <span class="sh_normal">library</span><span class="sh_symbol">/</span>centos</li><li>Digest<span class="sh_symbol">:</span> sha256<span class="sh_symbol">:</span>989b936d56b1ace20ddf855a301741e52abca38286382cba7f44443210e96d16</li><li>Status<span class="sh_symbol">:</span> Downloaded newer image <span class="sh_keyword">for</span> centos<span class="sh_symbol">:</span>latest</li><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># docker run <span class="sh_symbol">-</span>it cen<span class="sh_symbol">:</span>v1   <span class="sh_comment">//通过新建的标签启动cen:v1</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 docker_images]# docker tag  centos:latest cen:v1 
[root@docker1 docker_images]# docker images
REPOSITORY   TAG            IMAGE ID          CREATED          SIZE
        cen        v1             e934aafc2206   5 months ago    198.6 MB 
[root@docker1 docker_images]# docker rmi centos    //删除centos
[root@localhost ~]# docker run -it centos   
//启动的时候，因为是用标签标签启动的，所以会重新通过ID下载
[root@localhost ~]# docker run -it centos
Unable to find image 'centos:latest' locally
latest: Pulling from library/centos
Digest: sha256:989b936d56b1ace20ddf855a301741e52abca38286382cba7f44443210e96d16
Status: Downloaded newer image for centos:latest
[root@localhost ~]# docker run -it cen:v1   //通过新建的标签启动cen:v1
</pre></div></div>
      <p class="number">步骤二：容器命令</p>
      <p>1）关闭容器</p>
      <p>命令：docker stop 容器ID</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker stop 0f   <span class="sh_comment">//0f为容器ID</span></li><li>0f</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 docker_images]# docker stop 0f   //0f为容器ID
0f
</pre></div></div>
      <p>2）启动容器</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li> <span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker start 0f</li><li>0f</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;"> [root@docker1 docker_images]# docker start 0f
0f
</pre></div></div>
      <p>3）重启容器</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li> <span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker restart 0f</li><li>0f</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;"> [root@docker1 docker_images]# docker restart 0f
0f
</pre></div></div>
      <p>4）删除容器</p>
      <p>运行中删除不掉，先关闭容器</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker rm 0f  <span class="sh_comment">//删除失败</span></li><li><span class="sh_predef_func">Error</span> response from daemon<span class="sh_symbol">:</span> You cannot remove a running container 0f63706692e15134a8f07655a992771b312b8eb01554fc37e1a39b03b28dd05c<span class="sh_symbol">.</span> Stop the container before attempting removal or use <span class="sh_symbol">-</span>f</li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker stop 0f   <span class="sh_comment">//关闭容器</span></li><li>0f</li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker rm 0f &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//删除成功</span></li><li>0f</li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span>#</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 docker_images]# docker rm 0f  //删除失败
Error response from daemon: You cannot remove a running container 0f63706692e15134a8f07655a992771b312b8eb01554fc37e1a39b03b28dd05c. Stop the container before attempting removal or use -f
[root@docker1 docker_images]# docker stop 0f   //关闭容器
0f
[root@docker1 docker_images]# docker rm 0f 		//删除成功
0f
[root@docker1 docker_images]#
</pre></div></div>
      <p>5）连接容器attach|exec</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker attach  0f</li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker ps    <span class="sh_comment">//容器关闭</span></li><li>CONTAINER ID  IMAGE  COMMAND  CREATED  STATUS  PORTS  NAMES</li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span>#  docker exec <span class="sh_symbol">-</span>it 0<span class="sh_normal">f </span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>bash</li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker ps&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//容器不会关闭</span></li><li>CONTAINER ID  IMAGE         COMMAND        CREATED          STATUS          PORTS     NAMES</li><li>0b3c50284a1c  centos<span class="sh_symbol">:</span>v1      <span class="sh_string">"/bin/bash"</span>   <span class="sh_number">15</span> minutes ago   Up <span class="sh_number">15</span> minutes             tiny_lamarr</li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker top f7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//查看容器进程列表 </span></li><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># docker run <span class="sh_symbol">-</span>itd centos<span class="sh_symbol">:</span>latest</li><li><span class="sh_symbol">[</span>root@0<span class="sh_normal">b3c50284a1c </span><span class="sh_symbol">/]</span># ps</li><li>  PID TTY          TIME CMD</li><li>    <span class="sh_number">1</span> <span class="sh_symbol">?</span>        <span class="sh_number">00</span><span class="sh_symbol">:</span><span class="sh_number">00</span><span class="sh_symbol">:</span><span class="sh_number">00</span> bash</li><li>   <span class="sh_number">13</span> <span class="sh_symbol">?</span>        <span class="sh_number">00</span><span class="sh_symbol">:</span><span class="sh_number">00</span><span class="sh_symbol">:</span><span class="sh_number">00</span> ps  </li><li> <span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker exec <span class="sh_symbol">-</span>it <span class="sh_number">85</span><span class="sh_normal"> </span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>bash</li><li>root@85c6b0b62235<span class="sh_symbol">:/</span># sleep <span class="sh_number">50</span> <span class="sh_symbol">&amp;</span></li><li><span class="sh_symbol">[</span><span class="sh_number">1</span><span class="sh_symbol">]</span> <span class="sh_number">9</span></li><li>root@85c6b0b62235<span class="sh_symbol">:/</span># exit</li><li>exit</li><li><span style="display:none;">&nbsp;</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span>#docker top <span class="sh_number">85</span></li><li><span style="display:none;">&nbsp;</span></li><li>UID    PID  PPID C   STIME &nbsp;&nbsp;&nbsp;&nbsp;TTY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIME &nbsp;&nbsp;&nbsp;&nbsp; CMD</li><li>root  <span class="sh_number">2744</span> <span class="sh_number">2729</span>  <span class="sh_number">0</span>   <span class="sh_number">18</span><span class="sh_symbol">:</span><span class="sh_number">01</span>    <span class="sh_normal">pts</span><span class="sh_symbol">/</span><span class="sh_number">4</span>  <span class="sh_number">00</span><span class="sh_symbol">:</span><span class="sh_number">00</span><span class="sh_symbol">:</span><span class="sh_number">00</span><span class="sh_normal">   </span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>bash</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 docker_images]# docker attach  0f
[root@docker1 docker_images]# docker ps    //容器关闭
CONTAINER ID  IMAGE  COMMAND  CREATED  STATUS  PORTS  NAMES
[root@docker1 docker_images]#  docker exec -it 0f /bin/bash
[root@docker1 docker_images]# docker ps		//容器不会关闭
CONTAINER ID  IMAGE         COMMAND        CREATED          STATUS          PORTS     NAMES
0b3c50284a1c  centos:v1      "/bin/bash"   15 minutes ago   Up 15 minutes             tiny_lamarr

[root@docker1 docker_images]# docker top f7		//查看容器进程列表 
[root@localhost ~]# docker run -itd centos:latest
[root@0b3c50284a1c /]# ps
  PID TTY          TIME CMD
    1 ?        00:00:00 bash
   13 ?        00:00:00 ps  
 [root@docker1 docker_images]# docker exec -it 85 /bin/bash
root@85c6b0b62235:/# sleep 50 &amp;
[1] 9
root@85c6b0b62235:/# exit
exit


[root@docker1 docker_images]#docker top 85

UID    PID  PPID C   STIME 	TTY 		TIME 	 CMD
root  2744 2729  0   18:01    pts/4  00:00:00   /bin/bash
</pre></div></div>
      <p>6）过滤查看mac和ip地址</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker inspect <span class="sh_symbol">-</span>f <span class="sh_string">'{{.NetworkSettings.MacAddress}}'</span> 4f</li><li><span class="sh_number">02</span><span class="sh_symbol">:</span><span class="sh_number">42</span><span class="sh_symbol">:</span>ac<span class="sh_symbol">:</span><span class="sh_number">11</span><span class="sh_symbol">:</span><span class="sh_number">00</span><span class="sh_symbol">:</span><span class="sh_number">03</span></li><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker inspect <span class="sh_symbol">-</span>f <span class="sh_string">'{{.NetworkSettings.IPAddress}}'</span> 4f</li><li><span class="sh_number">172.17.0.3</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 docker_images]# docker inspect -f '{{.NetworkSettings.MacAddress}}' 4f
02:42:ac:11:00:03
[root@docker1 docker_images]# docker inspect -f '{{.NetworkSettings.IPAddress}}' 4f
172.17.0.3

</pre></div></div>
      <p>7）修改nginx的显示内容</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker run <span class="sh_symbol">-</span>it nginx<span class="sh_symbol">:</span>latest </li><li><span style="display:none;">&nbsp;</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 docker_images]# docker run -it nginx:latest 
 
</pre></div></div>
      <div class="image">
        <img src="./6CASE_files/image004.png">
      </div>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 docker_images<span class="sh_symbol">]</span># docker exec <span class="sh_symbol">-</span>it <span class="sh_number">56</span><span class="sh_normal"> </span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>bash</li><li>root@56ec8154f8e0<span class="sh_symbol">:</span><span class="sh_regexp">/# nginx -T /</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">share</span><span class="sh_symbol">/</span><span class="sh_normal">nginx</span><span class="sh_symbol">/</span><span class="sh_normal">html</span><span class="sh_symbol">/</span></li><li>nginx<span class="sh_symbol">:</span> invalid option<span class="sh_symbol">:</span> <span class="sh_string">"/usr/share/nginx/html/"</span>   <span class="sh_comment">//查找并显示结果</span></li><li>root@56ec8154f8e0<span class="sh_symbol">:</span><span class="sh_regexp">/# echo  aaa &gt; /</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">share</span><span class="sh_symbol">/</span><span class="sh_normal">nginx</span><span class="sh_symbol">/</span><span class="sh_normal">html</span><span class="sh_symbol">/</span>index<span class="sh_symbol">.</span>html </li><li><span class="sh_comment">//修改主页显示的内容</span></li><li>root@56ec8154f8e0<span class="sh_symbol">:/</span># nginx <span class="sh_symbol">-</span>T</li><li>root@56ec8154f8e0<span class="sh_symbol">:</span><span class="sh_regexp">/# cat /</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">share</span><span class="sh_symbol">/</span><span class="sh_normal">nginx</span><span class="sh_symbol">/</span><span class="sh_normal">html</span><span class="sh_symbol">/</span>index<span class="sh_symbol">.</span>html </li><li>aaa</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 docker_images]# docker exec -it 56 /bin/bash
root@56ec8154f8e0:/# nginx -T /usr/share/nginx/html/
nginx: invalid option: "/usr/share/nginx/html/"   //查找并显示结果
root@56ec8154f8e0:/# echo  aaa &gt; /usr/share/nginx/html/index.html 
//修改主页显示的内容
root@56ec8154f8e0:/# nginx -T
root@56ec8154f8e0:/# cat /usr/share/nginx/html/index.html 
aaa
</pre></div></div>
      <p>8）过滤查看nginx的ip地址</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/VIP/NSDVN201805/CLOUD/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># docker inspect <span class="sh_symbol">-</span>f <span class="sh_string">'{{.NetworkSettings.IPAddress}}'</span> <span class="sh_number">56</span></li><li><span class="sh_number">172.17.0.5</span></li><li><span class="sh_symbol">[</span>root@docker1 <span class="sh_symbol">~]</span># curl   <span class="sh_number">172.17.0.5</span></li><li>aaa</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@docker1 ~]# docker inspect -f '{{.NetworkSettings.IPAddress}}' 56
172.17.0.5
[root@docker1 ~]# curl   172.17.0.5
aaa
</pre></div></div>
    </div>
  
</body></html>