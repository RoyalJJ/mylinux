<!DOCTYPE html>
<html>
<head>
<title>Mysql</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
/* Author: Nicolas Hery - http://nicolashery.com */
/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
/* Source: https://github.com/nicolahery/markdownpad-github */

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="http://yandex.st/highlightjs/6.2/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<!--侧栏目录生成代码-->
<script>
    //标题序号计数器
    var hCount = [0, 0, 0, 0, 0, 0];
    //设置计数器
    function setHCount(number) {
        //当前计数器加一
        hCount[number - 1]++;
        for (var i = number, length = hCount.length; i < length; i++) {
            //子目录计数器全部置零
            hCount[i] = 0;
        }
    }
    //重命名目录名称
    function setHTagValue(item, number) {
        //获取标题名
        var text = $(item).get(0).innerHTML;
        //初始化空字符串
        var before = "";
        //生成序号
        for (var i = 0, length = hCount.length; i < number; i++) {
            if (i < number - 1)
                before += hCount[i] + ".";
            else
                before += hCount[i] + " ";
        }
        //在标题前面加上序号
        $(item).get(0).innerHTML = text;
    }
    function renameHTag(item) {
        var tag = $(item).get(0).localName;
        if (tag === "h1") {
            setHCount(1);
           //console\.log("捕获到标签:%s", tag);
            setHTagValue(item, 1);
        }
        if (tag === "h2") {
            setHCount(2);
            //console.log("捕获到标签:%s", tag);
            setHTagValue(item, 2);
        }
        if (tag === "h3") {
            setHCount(3);
            //console.log("捕获到标签:%s", tag);
            setHTagValue(item, 3);
        }
        if (tag === "h4") {
            setHCount(4);
            //console.log("捕获到标签:%s", tag);
            setHTagValue(item, 4);
        }
        if (tag === "h5") {
            setHCount(5);
            //console.log("捕获到标签:%s", tag);
            setHTagValue(item, 5);
        }
        if (tag === "h6") {
            setHCount(6);
            //console.log("捕获到标签:%s", tag);
            setHTagValue(item, 6)
        }
    }
    $(document).ready(function () {
        $("h1,h2,h3,h4,h5,h6").each(function (i, item) {
            //给<H>类标签编号
            renameHTag(item);
            //获取标签的名字,h1,还是h2
            var tag = $(item).get(0).localName;
            //为该标签设置id属性
            $(item).attr("id", "wow" + i);
            //添加一个页内超链接,并设置class选择器
            //      $("#category").append('<a class="new'+tag+'" href="#wow'+i+'">'+$(this).text()+'</a></br>');
            $("#category").append('<a class="new' + tag + '" href="#wow' + i + '">' + $(item).text() + '</a></br>');
            //为每一个标题超链接的class属性设置左边距
            $(".newh1").css("margin-left", 0);
            $(".newh2").css("margin-left", 20);
            $(".newh3").css("margin-left", 40);
            $(".newh4").css("margin-left", 60);
            $(".newh5").css("margin-left", 80);
            $(".newh6").css("margin-left", 100);
        });
        //设置class选择器为.book-body的html内容
        $(".book-body").html($(".book-body").nextAll())
    });
</script>
<style type="text/css">
    @media (max-width: 1600px) {
        .book-body {
            /* padding-left: 200px; */
            padding-right: 0px;
        }
    }
    @media (max-width: 1400px) {
        .book-body {
            /* padding-left: 200px; */
            padding-right: 0px;
        }
    }
    @media (max-width: 1200px) {
        .book-body {
            /* padding-left: 300px; */
            padding-left: 0px;
        }
    }
    @media (max-width: 700px) {
        .book-body {
            padding-left: 0px;
        }
    }
    @media (min-width: 600px) {
        #category {
            /* 绝对定位 */
            position: fixed;
            /* left: 20px; */
            /* 目录显示的位置 */
            right: 0px;
            top: 0;
            /* 目录栏的高度,这里设置为60%主要是为了不挡住返回顶部和折叠按钮 */
            height: 79%;
            /* 开启垂直滚动条 */
            overflow-y: scroll;
            /* 开启水平滚动条 */
            overflow-x: scroll;
        }
    }
    @media (-webkit-max-device-pixel-ratio: 1) {
        ::-webkit-scrollbar-track-piece {
            background-color: #FFF
        }
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px
        }
        ::-webkit-scrollbar-thumb {
            background-color: #c2c2c2;
            background-clip: padding-box;
            min-height: 28px
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: #A0A0A0
        }
    }
</style>
<script>
    // id="category" onclick="showOrCloseCategory()"
    function showOrCloseCategory() {
        var id = document.getElementById("category");
        var book_body=document.getElementById("book_body");
        //如果展开了
        if (id.style.display == 'block') {
            //console.log("开始展开");
            id.style.display='none';
            id.style.width="0%";
            book_body.style.width="100%";
            book_body.style.paddingleft=0;
        }
        //如果被折叠了
        else if (id.style.display =='none') {
            //console.log("开始折叠");
            id.style.display = 'block';
            book_body.style.width="90%";
            id.style.width="20%"
        }
    }
</script>
<!--返回顶部-->
<a href="javascript:scroll(0,0)" style="position:fixed;float:right;right:40px;top:80%">返回顶部</a>
<button onclick="showOrCloseCategory()" style="position:fixed;float:right;right:40px;top:85%">折叠/展开</button>
<!--文章主体部分-->
<div class="book-body" id="book_body" style="width:90%;display:block"> </div>
<!--目录栏，设置占用宽度为20%可以根据实际情况设置-->
<div  class="book-summary" id="category" style="width:20%;display:block" ></div>

</head>
<body>
<h2>1.Mysql简介</h2>
<pre><code>数据库应用场景:
咨询类型网站:存新闻,存评论,存用户信息. 
电商类:商品,订单,用户信息
社交类:微博
IO流文件存储的弊端:
1. 效率低(开发效率低,执行效率也低)
2. 数据的增删改查非常麻烦
3. 只能保存少量数据
4. 只能存储文本数据
</code></pre>

<h3>1.1什么是DB?</h3>
<pre><code>DataBase:数据库,数据库实际上就是一个文件集合,本质就是一个文件系统,数据按照特定的格式存储到文件中,使用sql语言对数据进行增删改查操作.
</code></pre>

<h3>1.2什么是DBMS?</h3>
<pre><code>DataBaseManagementSystem:数据库管理系统,管理数据库文件的软件, 用于建立,使用和维护数据库,
对数据进行统一的管理和控制,用户通过DBMS访问数据库中的数据. 常见:mysql oracle db2 sqlserver sqlite
</code></pre>

<h3>1.3数据库的分类</h3>
<ol>
<li>关系型数据库:经过数学理论验证,可以将现实生活中存在的各种关系,保存到数据库中. 在此数据库中,以表的形式保存数据之间的关系</li>
<li>非关系型数据库: 主要为了解决特定的应用场景,如:缓存,高并发访问等. redis是常见的非关系型数据库</li>
</ol>
<h3>1.4数据库介绍</h3>
<ol>
<li>mysql: 芬兰MySql创始人，08年mysql以10亿美金被sun收购,09年 sun被oracle收购 ,现在属于oracle公司,开源,市场占有最高.被oracle收购后出了5.5版本由于使用了oracle核心技术,性能有了大幅提高,导致oracle用户流失,公司决定将mysql闭源,导致原mysql程序员离开并创建了mariaDB,maria创始人的女儿名字</li>
<li>oracle: oracle公司,性能最强大的数据库,而且收费最贵,通常不缺钱却技术的公司会选用,市场排名第二</li>
<li>DB2: IBM公司,闭源收费,通常一些银行项目会使用</li>
<li>sqlserver: 微软公司,排名第三,闭源收费,提供整套解决方案(web服务器,操作系统,数据库服务器等)</li>
<li>sqlite:轻量级数据库,应用在嵌入式或移动设备中,大小只有几十k,功能和性能较大型数据库要少很多.</li>
</ol>
<h3>1.5mysql安装连接及规范</h3>
<pre><code>mysql安装: 端口号选择默认的3306, 字符集选择utf-8.
Mysql客户端有: Navicat,Sqlyog,MySql-font,Workbench,HeidiSQL等
连接数据库: 终端或命令行输入: mysql -uroot -p -h192.168.xxx.xxx -P3306 回车,输入密码(没有则不输入),回车.
连接网络远程数据库服务器,需要创建可以远程连接的用户,或者以root身份连接. MySql的用户，由“用户名”+ “ip地址”来标识.例如: 'root'@'localhost', 'root'@127.0.0.1'
对用户授权: 允许访问的库,表, 允许执行的操作.语法:create user 'abc'@'localhost' identified by '123456' 这样授权的时候就不需要指定连接的密码了.grant select,insert on db1.t1 to 'abc'@'%'
对root用户: grant all privileges on *.*  to ‘root’@’%’ identified by ‘root’;
sql规范:
    1. 以;(分号)结尾
    2. 关键字之间有空格
    3. 可以存在换行
    4. 数据库名称和表名称区分大小写
</code></pre>

<h2>2.数据库的相关操作</h2>
<pre><code>查看所有数据库: show databases; 等价于 show schemas;
创建数据库: create database db1; 指定字符集: create database 数据库名称 character set gbk;例:create database db2 character set gbk; 或者 create database db2 charset gbk;
修改字符集:alter database db2 character set utf8或者charset utf8都可以
查看指定数据库详情: show create database db1;
删除数据库: drop database db2;
使用数据库: use db1;
查看数据库目录: show variables like '%datadir%';
</code></pre>

<h3>2.1表的相关操作</h3>
<h4>2.1.1什么是表?</h4>
<p>表是关系型数据库存储数据的单位,数据库中存储数据需要先创建表.执行表相关的sql时一定要先选择数据库.</p>
<h4>2.1.2操作</h4>
<pre><code>1. 创建表: create table 表名(字段1名 字段1类型, 字段2名 字段2类型,.....);
2. 创建表sql语句的执行过程: 在终端中写完sql语句后敲回车终端会把sql通过网络传输到DBMS(mysql),DBMS对sql语句进行解析,然后对数据库中的数据进行操作
3. 查看所有表: show tables;查看指定表详情: show create table 表名 [\G];
4. 查看表的字段信息: desc 表名;
5. 创建表指定引擎和字符集: create table t1(id int,name varchar(10)) engine=myisam charset=gbk;
6. 删除表: drop table t1;
</code></pre>

<h4>2.1.3表的引擎</h4>
<pre><code>1. innodb: 默认的存储引擎,支持数据库的高级操作,包括:事务丶外键, 支持行级锁 
2. myisam:支持数据的增删改查操作,一般用来访问数据, 不支持事务, 不支持外键, 表级锁, 访问数据效率高
3. memory 内存表
</code></pre>

<h4>2.1.4表的修改</h4>
<pre><code>1. 修改表的名称  格式: rename table 原名 to 新名;
2. 修改表的引擎和字符集 格式: alter table 表名 engine=myisam charset=gbk;
3. 添加表的字段:alter table 表名 add 字段名 字段类型; (默认在最后面添加). 最前面添加: alter table 表名 add 字段名 字段类型 first; 某个字段的后面添加: alter table 表名 add 字段名 字段类型 after 字段名;  
4. 删除字段 格式:alter table 表名 drop 字段名;
5. 修改字段名称和类型 格式:alter table 表名 change 原字段名 新字段名 字段类型
6. 修改字段的类型和位置 格式:alter table 表名 modify 字段名 字段类型 first/after xxx
</code></pre>

<h4>2.1.5表的字节及测试</h4>
<ol>
<li>表的所有字段字节宽度之和，不能大于65535</li>
<li>表中存在允许null值的字段，需要一个额外字节</li>
<li>varchar当字节宽度&lt;=255，需要一个额外字节表示长度；&gt;255，需要2个额外字节表示长度</li>
<li>
<p>text，只占用表字节宽度的10个字节</p>
<pre><code>表的字节宽度限制测试:
use db1;
drop table if exists tb1;
create table tb1( -- 1字节表示null
a int, -- 4字节
b double, -- 8字节
c varchar(65520) -- 65520+2
)engine=innodb charset=latin1;
当超过了65535如:
use db1;
drop table if exists tb1;
create table tb1( -- 1字节表示null
a int, -- 4字节
b double, -- 8字节
c varchar(65521) -- 65521+2
)engine=innodb charset=latin1;
则会报: ERROR 1118 (42000): Row size too large. The maximum row size for the used table type, not counting BLOBs, is 65535. This includes storage overhead, check the manual. You have to change some columns to TEXT or BLOBs
</code></pre>

</li>
</ol>
<h2>3.SQL相关操作及事务</h2>
<h3>3.1数据操作</h3>
<pre><code>1. 全表插入:要求插入的数据的数量和顺序要和表字段的数量顺序一致,格式:insert into 表名 values(值1,值2,值3....);
2. 指定字段插入格式:insert into 表名 (字段1,字段2...) values(值1,值2...);
3. 批量插入: insert into 表名 (字段1,字段2) values(值1,值2), (值3,值4);insert into 表名 values(1,’张三’),(2,’李四’);
4. 查询数据: select * from 表名;  select name,age from 表名; 当带条件时查询列值为null用 is null,列值不为null使用 is not null
5. 删除数据: delete from 表名 where age is null; 若不加条件则是全表删除.delete支持事务;truncate不支持事务,作用是删除该表并重新创建该表,若有自增,则会清零.
6. 修改数据: update 表名 set name='张三' where id=1; 若不指定where条件则该字段的所有记录都将被更新.
</code></pre>

<h3>3.2在eclipse中执行sql步骤</h3>
<pre><code>1. 下载mysql-connector-java-5.1.6.jar 文件 记住下载的位置
2. 在eclipse-&gt;window-&gt;show View-&gt;Other -&gt;Data Management里面选择 第一个和第三个
3. 在DataManagementExplorer里面第一个文件夹上面右键new 在弹出窗口中选择 mysql,点击下拉选旁边的添加按钮
4. 在弹出窗口中选择5.1 第二个选项卡先clearall 然后添加下载的文件 最后ok
5. 修改url 把最后的database改成db2 有密码的添加密码没有直接 点击test connection  显示ping successed 点击finish
6. 在新建的文件上面右键 open sql scrapbook
</code></pre>

<h3>3.3小知识点</h3>
<pre><code>注释comment:在创建表的时候可以通过comment对字段进行描述. 例: create table t3(id int primary key auto_increment comment '这是主键’);查看注释: show create table t3;
</code></pre>

<pre><code>`和'的区别: 1.`是在创建表时,修饰表名和字段的名的,可以省略. create table `t4`(id int,`age` int); 2.'是用来表示字符串的
</code></pre>

<pre><code>数据冗余: 如果数据库设计不合理,保存数据后会出现大量的重复数据,这种现象称为数据的冗余 ,通过拆分表格的形式,把可能大量重复的数据,用单独一张表保存,在原表中只需要通过id建立关系即可.
</code></pre>

<h3>3.4事务</h3>
<h4>3.4.1什么是事务?</h4>
<p>事务是数据库中执行sql语句的最小工作单元,在同一个事务中的sql语句要么都成功,要么都失败. mysql数据库默认sql语句是自动提交的</p>
<pre><code>1) 查看自动提交的状态: show variables like '%autocommit%';
2) 关闭自动提交  如果需要打开自动提交把0换成1
3) 回滚 rollback: 执行rollback会回滚到上次提交的点或者关闭自动提交时的点
4) 保存回滚点 savepoint s1(标识),例如:
    update person set money=100 where id=1;
    savepoint s1;
    update person set money=200 where id=1;
    rollback to s1;
</code></pre>

<h4>3.4.2事务操作</h4>
<pre><code>开始事务: start transaction; begin; 数据增删改操作，不直接修改数据表, 而是在日志文件中记录修改
提交事务: commit; 将日志中记录的修改操作，永久保存到数据表,然后日志文件清空
回滚事务: rollback; 日志文件清空
事务隔离级别: 数据库为了保证数据安全，让多个事务并发执行时，进行隔离.但是为了兼顾性能，让事务一定程度上可以并行执行
</code></pre>

<h4>3.4.3事务隔离</h4>
<pre><code>隔离级别设置：
set tx_isolation='read-uncommitted';
set tx_isolation='read-committed';
set tx_isolation='repeatable-read';
set tx_isolation='serializable';
数据访问冲突:
1) 脏读: 读取到其他事务未提交的数据
2) 不可重复读: 一个事务提交的数据，可以被另一个事务立即读取,可能发生与第一次查询数据不一致
3) 幻读: 读取到已经被删除的数据,读取不到新插入的数据   
四种隔离级别会发生的数据访问问题：
1)read-uncommitted: 脏读，不可重复读，幻读
2) read-committed: 不可重复读，幻读
3) repeatable-read (默认): 幻读
4) serializable
隔离级别越高，效率越低.
</code></pre>

<h4>3.4.4隔离级别测试</h4>
<table>
<thead>
<tr>
	<th>会话一</th>
	<th>会话二</th>
</tr>
</thead>
<tbody>
<tr>
	<td>set tx_isolation='read-uncommitted';</td>
	<td>set tx_isolation='read-uncommitted';</td>
</tr>
<tr>
	<td>rollback; begin;</td>
	<td>rollback; begin;</td>
</tr>
<tr>
	<td>insert into user(username) values('D'); update user set username='R' where id=1;</td>
	<td>&nbsp;</td>
</tr>
<tr>
	<td></td>
	<td>select * from user;</td>
</tr>
<tr>
	<td>rollback;</td>
	<td>&nbsp;</td>
</tr>
<tr>
	<td></td>
	<td>select * from user;</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
	<th>会话一</th>
	<th>会话二</th>
</tr>
</thead>
<tbody>
<tr>
	<td>set tx_isolation='read-committed';</td>
	<td>set tx_isolation='read-committed';</td>
</tr>
<tr>
	<td>rollback; begin;</td>
	<td>rollback; begin;</td>
</tr>
<tr>
	<td></td>
	<td>select * from user;</td>
</tr>
<tr>
	<td>insert into user(username) values('E'); update user set username='S' where id=1;</td>
	<td>&nbsp;</td>
</tr>
<tr>
	<td></td>
	<td>select * from user;</td>
</tr>
<tr>
	<td>commit;</td>
	<td>&nbsp;</td>
</tr>
<tr>
	<td></td>
	<td>select * from user;</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
	<th>会话一</th>
	<th>会话二</th>
</tr>
</thead>
<tbody>
<tr>
	<td>set tx_isolation='repeatable-read';</td>
	<td>set tx_isolation='repeatable-read';</td>
</tr>
<tr>
	<td>rollback; begin;</td>
	<td>rollback; begin;</td>
</tr>
<tr>
	<td></td>
	<td>select * from user;</td>
</tr>
<tr>
	<td>insert into user(username) values('F'); update user set username='T' where id=1;</td>
	<td>&nbsp;</td>
</tr>
<tr>
	<td>commit;</td>
	<td>&nbsp;</td>
</tr>
<tr>
	<td></td>
	<td>select * from user;</td>
</tr>
<tr>
	<td></td>
	<td>update user set password='111';</td>
</tr>
<tr>
	<td></td>
	<td>select * from user;</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
	<th>会话一</th>
	<th>会话二</th>
</tr>
</thead>
<tbody>
<tr>
	<td>rollback; begin;</td>
	<td>rollback; begin;</td>
</tr>
<tr>
	<td></td>
	<td>select * from user;</td>
</tr>
<tr>
	<td>delete from user where id&lt;5;</td>
	<td>&nbsp;</td>
</tr>
<tr>
	<td>commit;</td>
	<td>&nbsp;</td>
</tr>
<tr>
	<td></td>
	<td>select * from user;</td>
</tr>
<tr>
	<td></td>
	<td>update user set password='222';</td>
</tr>
<tr>
	<td></td>
	<td>select * from user;</td>
</tr>
<tr>
	<td></td>
	<td>commit;</td>
</tr>
<tr>
	<td></td>
	<td>select * from user;</td>
</tr>
</tbody>
</table>
<h4>3.4.5事务的ACID特性</h4>
<ol>
<li>Atomicity:原子性,最小 不可再次拆分</li>
<li>Consistency:一致性,同时成功,同时失败</li>
<li>Isolation:隔离性, 事务之间的数据隔离,多个事务之间互不影响</li>
<li>Durability:持久性, 事务一旦达成,就永久有效.数据持久保存到数据库.</li>
</ol>
<h3>3.5SQL分类</h3>
<ol>
<li>DDL Data Definition Language 数据定义语言,包括: create drop alter truncate, 不支持事务.</li>
<li>DML Data Manipulation Language 数据操作语言,包括: insert update delete select(),支持事务</li>
<li>DQL Data Query Language 数据查询语言,只有select, 属于DML</li>
<li>TCL Transaction Control Language 事务控制语言,包括:commit rollback savepoint  rollback to</li>
<li>DCL Data Control Language 数据控制语言,分配用户权限的相关sql</li>
</ol>
<h2>4.数据库数据类型(五大类)</h2>
<pre><code>1. 整数类型：BIT、BOOL、TINY INT、SMALL INT、MEDIUM INT、 INT、BIG INT
2. 浮点数类型：FLOAT、DOUBLE、DECIMAL
3. 字符串类型：CHAR、VARCHAR、TINY TEXT、TEXT、MEDIUM TEXT、LONGTEXT、TINY BLOB、BLOB、MEDIUM BLOB、LONG BLOB
4. 日期类型：Date、DateTime、TimeStamp、Time、Year
5. 其他数据类型：BINARY、VARBINARY、ENUM、SET、Geometry、Point、MultiPoint、LineString、MultiLineString、Polygon、GeometryCollection等
</code></pre>

<h3>4.1常用</h3>
<pre><code>1. 整型 常用:int(m)4个字节 bigint(m)8个字节 m代表显示长度,如果字段数值长度不到m时 会在数值的前面补零,但是一定要和 zerofill结合使用. 例如: create table t_int(num int(10) zerofill);
2. 浮点数 常用:double(m,d)8字节 m代表总长度,d代表小数长度 如:76.232    m=5 d=3; decimal(m,d) 超高精度小数,需要涉及高精度运算时使用decimal.
3. 字符串 char(m): 长度不可变 m=20  abc虽然只有3个字母却会占20个位,执行效率高 最多255个字符 . varchar(m):长度可变 m=20  abc有三个字母就只占三位,节省资源.最多65535个字符,但是超过255建议使用text. varchar如果指定的最大长度，若最大长度在255个字节内，在前面会加1个字节，表示字符串的字节长度,最大长度大于255，在前面加2个字节，表示字符串的字节长度.text: 可变长度,最大65535
4. 日期类型:
    1. date: 只能保存年月日
    2. time: 只能保存时分秒
    3. datatime:年月日时分秒 9999-12-31 默认值为null
    4. timestamp:年月日时分秒 2038-01-19 默认值为当前时间
    表中存在允许null值的字段，需要一个额外字节
</code></pre>

<h2>5.函数及计算</h2>
<h3>5.1通配符</h3>
<pre><code>通配符：
_     单个字符
%     多个字符
\_    转义，普通下划线字符
\%    转义，普通百分号字符
\\    转义，普通斜杠字符
单引号转义: 用两个单引号转义成一个单引号:例
create table tb1(a varchar(20));  
insert into tb1 values('a'b');插入不成功
insert into tb1 values('a''b'); 插入成功
</code></pre>

<h3>5.2小知识点</h3>
<pre><code>别名: select empno as '员工编号',ename as '姓名' from emp;
去重 distinct:例 查询emp表中所有员工的职位 select distinct job from emp;
比较运算符   &gt; &lt; = &gt;= &lt;=  !=(&lt;&gt;)
and和or
in , not in: 如果查询字段的值为多个的时候可以使用in关键字,例 查询person表中 年龄(age)是25,28,30,22岁的所有信息 select * from person where age in (25,28,30,22);
between x and y:   not between x and y
like模糊匹配:    _:代表单个未知字符   %:代表多个未知字符
order by: 格式: order by 字段名, 默认升序, 指定升序是:asc  降序:desc
ifnull() : 格式: age=ifnull(x,y) 判断x是否为null如果是 age=y如果不是age=x;
coalescs(1,2,3,4,5,6,7....) 获取第一个非空值

分页limit: limit 哪条开始(起始0),查询条数. 分页查询没有标准sql语法，数据库厂商各自扩展了分页查询语法
Oracle分页:
select * from
(select *,rownum r from
(select ... from ...)
   where rownum&lt;=100)
   where r&gt;=91
mysql 分页:
limit 10       前10行
limit 0,10     第1行开始的10行
limit 10,10    第11行开始的10行
limit 100,10   第101行开始的10行
数据量大时(千万)，分页数据越往后越慢

数值计算 + - * /  % (mod()):
</code></pre>

<h3>5.3日期相关函数</h3>
<pre><code>1. 获取当前日期+时间  now()   select now();
2. 获取当前日期    select curdate();
3. 获取当前时间    select curtime();
4. 从日期和时间中提取日期   select date(now());
5. 从日期和时间中提取时间   select time(now());
6. EXTRACT(字段 From 日期)  提取年 月 日 时 分 秒.字段的合法值：
MICROSECOND 
SECOND 
MINUTE 
HOUR 
DAY 
WEEK 
MONTH  
QUARTER 
YEAR  
SECOND_MICROSECOND  
MINUTE_MICROSECOND 
MINUTE_SECOND 
HOUR_MICROSECOND 
HOUR_SECOND 
HOUR_MINUTE 
DD DAY_SECOND 
DAY_MINUTE 
DAY_HOUR 
YEAR_MONTH
例子:
select extract(year from now());    
select extract(month from now()); 类推
7. 日期格式化 date_format(): date_format(时间,格式)
-%Y 4位年  2018
-%y 2位年  18
-%m 2位月  05
-%c 1位月  5
-%d 日  
-%H 24小时
-%h 12小时
-%i 分
-%s 秒
例: select date_format(now(),'%Y年%m月%d日 %H时%i分%s秒');
8.把不规则日期格式转成标准格式 格式: str_to_date(日期字符串,格式)
例: select str_to_date('25号12月2015年','%d号%m月%Y年');
DATE_ADD(日期, INTERVAL 数量 字段)   给日期添加指定的时间间隔
DATE_SUB(日期, INTERVAL 数量 字段)   从日期减去指定的时间间隔
DATEDIFF(日期1, 日期2)   返回两个日期之间的天数
LAST_DAY(日期) - 返回当月最后一天
格式字符:
%a  缩写星期名
%b  缩写月名 
%c  月，数值 
%D  带有英文前缀的月中的天 
%d  月的天，数值(00-31) 
%e  月的天，数值(0-31) 
%f  微秒 
%H  小时 (00-23) 
%h  小时 (01-12) 
%I  小时 (01-12) 
%i  分钟，数值(00-59) 
%j  年的天 (001-366) 
%k  小时 (0-23) 
%l  小时 (1-12) 
%M  月名 
%m  月，数值(00-12) 
%p  AM 或 PM 
%r  时间，12-小时（hh:mm:ss AM 或 PM） 
%S  秒(00-59) 
%s  秒(00-59) 
%T  时间, 24-小时 (hh:mm:ss) 
%U  周 (00-53) 星期日是一周的第一天 
%u  周 (00-53) 星期一是一周的第一天 
%V  周 (01-53) 星期日是一周的第一天，与 %X 使用 
%v  周 (01-53) 星期一是一周的第一天，与 %x 使用 
%W  星期名 
%w  周的天 （0=星期日, 6=星期六） 
%X  年，其中的星期日是周的第一天，4 位，与 %V 使用 
%x  年，其中的星期一是周的第一天，4 位，与 %v 使用 
%Y  年，4 位 
%y  年，2 位
</code></pre>

<h3>5.4聚合函数(多行函数)</h3>
<p>定义:对多行数据进行合并统计. 聚合函数，不能和其他普通字段一起查询(其他数据库会禁止执行, mysql可以执行，只是把第一条数据显示出来). 聚合函数会忽略null值</p>
<ol>
<li>求和  sum(字段名) 比如:求工资总和 sum(sal)</li>
<li>平均值 avg(字段名) 比如:求工资平均值 avg(sal)</li>
<li>最大值 max(字段名) 比如:求奖金最大值 max(comm)</li>
<li>最小值 min(字段名) 比如:求年龄最小值 min(age)</li>
<li>统计数量 count(*)</li>
</ol>
<h3>5.5字符串相关函数</h3>
<pre><code>1. concat(a,b)  字符串连接函数 select concat('a','b')
2. char_length(str) 获取字符串的长度
3. instr(str,subStr)获取subStr在str中的位置
4. locate(subStr,str)获取subStr在Str中的位置
5. insert(str,start,length,newstr)插入字符串.例: select insert('abcdefg',3,2,'m');  结果: abmefg
6. lower(str) 转小写
7. upper(str) 转大写
8. trim(str) 去两端空白
9. left(str,length) 从左边截取多少个字符
10. right(str,length)从右边截取多少个字符
11. substring(str,index,length)截取字符串
12. replace(str,old,new) 替换字符串 例: select replace('我爱共产党','我','你们');
13. repeat(str,count)重复 例: select repeat('加油',2);
14. reverse(str) 反转
</code></pre>

<h3>5.6数学相关函数</h3>
<pre><code>1. 向下取整 floor(num) 例: select floor(3.23);
2. 四舍五入 round(num)  round(num,m) 例: select round(2.7); -&gt; 3   select round(3.283749,2); -&gt; 3.28
3. truncate(num,m); 非四舍五入  例: select truncate(3.283749,1); -&gt; 3.2
4. 随机数 rand()  范围:0-1
5. 加密函数
    md5():
    1) 单向加密，不能解密
    2) 任何数据，加密成32位16进制字符
    3) 一般用来加密保存用户密码
    sha():
    1) 单向加密，不能解密
    2) 任何数据，加密成40位16进制字符
</code></pre>

<h3>5.7分支</h3>
<pre><code>分支:if(1,2,3) 1是真,返回2;1是假,返回3
case 字段或表达式:
    when 条件1 then ....
    when 条件2 then ....
    else ...
end
分支测试:工资&gt;=15000，有钱;工资&gt;=8000，小康;工资&gt;=3000，温饱;否则，穷逼
select
    employee_id,first_name,salary,
case
    when salary&gt;=15000 then '有钱'
    when salary&gt;=8000 then '小康'
    when salary&gt;=3000 then '温饱'
    else '穷逼'
end s
from employees
order by salary desc;
</code></pre>

<h2>6.查询</h2>
<h3>6.1分组查询</h3>
<pre><code>分组查询 group by: 分组查询通常和聚合函数结合使用
Having 有条件的分组统计, where后面只能对普通字段进行筛选, having写在 group by 后面,通常是和group by结合使用.
总结: 
1)普通字段的条件写在where后面,聚合函数条件写在having后面,having写在group by后面
2)sql中各个关键字的顺序: select .... from 表名 where ....group by.... having....order by....limit
</code></pre>

<h3>6.2子查询</h3>
<pre><code>什么是子查询?嵌套在sql语句里面的sql查询语句,称为子查询.特点:
1. 子查询可以有多层嵌套
2. 子查询可以写在的位置有:
    1. 写在where/having后面做查询条件的值
    2. 写在from后面当成一张新的表,**必须起别名**,例: select * from (select * from xxx) t1;
    3. 可以写在创建表的时候,例: create table newemp as (select ename,sal from emp);
3. 可以写在创建表的时候,例: create table newemp as (select ename,sal from emp);
从一个查询的结果中，再查询,叫做行内视图. mysql行内视图，必须起别名!
</code></pre>

<h3>6.3联合查询</h3>
<pre><code>union联合查询:
1) union 去除重复行
2) union all  不去除重复行
将多个查询的结果，组合成一个查询结果.如: (select ...) union (select ...)
要求: 字段列表数量必须相同.例如:查询最早入职的5人，和最晚入职的5人
    (select employee_id,first_name,salary,hire_date
    from employees
    order by hire_date limit 5)
    union
    (select employee_id,first_name,salary,hire_date
    from employees
    order by hire_date desc limit 5)
    order by hire_date;
</code></pre>

<h3>6.4关联查询</h3>
<pre><code>同时查询多张表的数据称为关联查询
笛卡尔积: 关联查询如果不写关联关系,则查询结果为两张表的乘积,这个乘积称为笛卡尔积. 笛卡尔积是一种错误的查询结果,工作中不能出现.
</code></pre>

<h3>6.5连接</h3>
<pre><code>1. 等值连接和内连接: 等值连接和内连接都是关联查询的查询方式,效果相同.
    1)等值连接格式:select * from A,B where    A.x=B.x and A.y=abc;
    2)内连接格式: select * from A [inner] join B on A.x=B.x where A.y=abc;
    内连接可读性更高,所以尽量使用内连接
2. 外连接: 关联查询时只能查询两张表有关系的数据,不能满足需求,如果需要查询某一张表所有数据(包含没有关系的),则使用外连接查询方式.
    1)左外连接:以join 左边表为主表查询所有数据,右边表只查询有关联关系的数据
    2)右外连接:以join 右边表为主表查询所有数据,左边表只查询有关联关系的数据
小结: 连接方式,包括内连接(等值连接)和外连接(左外和右外),是指通过sql查询两张表数据时使用的查询方式.
</code></pre>

<h3>6.6表设计之关联关系</h3>
<ol>
<li>一对一 应用场景: 用户表和用户信息扩展表,商品表和商品信息扩展</li>
<li>一对多 应用场景:部门和员工,商品和分类等</li>
<li>多对多 什么是多对多?AB两张表,A表中的一条数据对应B表的多条数据,同时B表的一条数据对应A表的多条数据,这种关系称为多对多. 应用场景: 老师表和学生表,用户表和角色表</li>
<li>自关联 什么是自关联?在一张表中有一个字段指向当前表的id,这种称为自关联. 什么时候使用自关联?当保存的数据有层级关系并且不确定有多少层的时候使用自关联.</li>
</ol>
<h2>7.视图</h2>
<blockquote>
<p>什么是视图?</p>
<blockquote>
<p>数据库中存在多种对象,表和视图都是数据库中的对象,创建视图时名称不能和表名重名,视图实际上是代表了一段sql查询语句,可以理解成视图是一张虚拟的表,表中的数据会随着原表的改变而改变.</p>
</blockquote>
<p>为什么使用视图?</p>
<blockquote>
<p>因为有些数据的查询需要书写大量的sql语句,每次书写比较麻烦,使用视图可以起到sql重用的作用,可以隐藏敏感信息</p>
</blockquote>
</blockquote>
<pre><code>创建视图的格式: create view 视图名 as 子查询;例如: create view v_emp_10 as (select * from emp where deptno=10);
</code></pre>

<h3>7.1视图的分类</h3>
<pre><code>1. 简单视图:创建视图的子查询中不包含:去重,函数,分组,关联查询的视图称为简单视图. 可以进行增删改操作
2. 复杂视图: 和简单视图相反.

在简单视图中进行增删改操作:
1)视图中插入数据:insert into v_emp_10 (empno,ename,deptno,sal) values (10001,'张三',10,300);
 注 数据污染: 往视图中插入一条视图中不显示,但是原表会显示的数据称为数据污染,如果需要避免数据污染的出现,创建视图时需要使用 with check option的关键字.
例: 
  insert into v_emp_10 (empno,ename,deptno,sal) values (10002,'李四',20,400); 数据污染!
  create view v_emp_20 as (select * from emp where deptno=20) with check option;
  insert into v_emp_20 (empno,ename,deptno,sal) values (10003,'王五',20,400);(成功)
  insert into v_emp_20 (empno,ename,deptno,sal) values (10004,'赵六',10,400);(失败)
2)在视图中修改和删除数据,修改和删除操作方式和table一样, 修改和删除只能操作视图中存在的数据
    update v_emp_10 set sal=500 where empno=10001;
    delete from v_emp_10 where sal=500;
3)修改视图 格式: create or replace view 视图名 as 子查询
4)删除视图 格式: drop view v_emp_20; drop view if exists v_emp_20;(如果存在删除 不存在也不会报错)
5)视图别名: 如果创建视图的时候对子查询的字段使用了别名,则对视图操作的时候只能使用别名.
例: 
create view v_emp_name as (select ename name from emp);
update v_emp_name set name='abc' where name='李四';

视图总结:
1)  视图是数据库中的对象,代表一段sql语句
2)  作用:重用sql,隐藏敏感信息
3)  分类:简单视图(不包含函数,去重,分组,关联查询)(可以进行增删改查操作)和复杂视图(和简单相反)(只能查)
4)  工作中一般使用视图时只进行查询操作,如果需要增删改则直接对原表进行操作
</code></pre>

<h2>8.约束</h2>
<blockquote>
<p>什么是约束?</p>
<blockquote>
<p>就是创建表的时候给表字段添加的限制条件</p>
</blockquote>
</blockquote>
<pre><code>1. 主键约束:非空且唯一, 一个表中只有一个主键.如何使用? create table t1(id int primary key,name varchar(10));
主键+自增 primary key auto_increment. 如何使用? create table t2(id int primary key auto_increment,age int);
自增:
1)  当自增字段的值为null时会自动赋值并自增
2)  以表中曾出现的最大值+1
3)  删除数据自增数值不减
4)  即使delete删除所有数据 自增值在原来基础上继续+1

取消自增,修改字段时,不写auto_increment就是取消. 例:alter table tb5 modify id int;

获取新产生的自增id值: 调用函数 last_insert_id() 获取新产生的自增id, 只获取当前会话（一次连接，一个客户端）产生的id值

用字段的组合作为主键, 不推荐使用,例:
create table tb(
name varchar(20),
ip varchar(20),
primary key(name,ip)
);
或者: alter table tb add primary key(name,ip)

删除主键约束: alter table tb4 drop primary key; 取消主键时，不自动取消非空约束，可以选择手动取消非空: alter table tb4 modify id int null;

2. 唯一约束 unique: 添加唯一约束的字段值不能重复. 唯一约束会自动创建索引.使用: 
    create table t_unique(id int,age int unique);  或者
    create table t_unique(id int,age int,unique key(age)
3. 默认约束 default: 给字段设置默认值,当字段不赋值的时候,默认值生效.
    使用: create table t_def(id int,age int default 10);
4. 检查约束 check: mysql不支持,但语法通过不会报错
5. 外键约束:用来保证两张表之间数据一致性和完整性的约束.创建外键，会自动创建索引.
    1)  添加约束后:外键的值可以为null,可以重复,但不能是另外一张表不存在的数据
    2)  添加约束后,外键指向的表(dept)不能先删除,如果需要删除,要么删除外键约束,要么先删除存在外键的表(emp)
    3)  添加约束后,外键指向的数据不能先删除
    4)  外键的值通常指向另外一张表的主键
    5)  使用外键必须两张表使用相同的引擎(innodb),myisam不支持外键
    6)  工作中除非特殊情况,一般不使用外键约束,使用java代码通过逻辑可以对数据进行限制,因为加了外键约束后不方便测试
    7)  添加外键约束的格式: create table emp(id int,age int,deptid int,constraint 约束名 foreign key(deptid) references 关联表名(关联的字段名));
    8)  取消外键，不会自动删除索引, 如果不再需要索引，要单独删除索引

    取消外键: alter table tb1 drop foreign key xxx;
    删除索引（可选）: alter table xuesheng drop index xxx;
</code></pre>

<h2>9.索引</h2>
<blockquote>
<p>什么是索引?</p>
<blockquote>
<p>索引是用来提高查询速度的技术,类似一个目录. mysql的innodb和myisam存储引擎，索引数据结构都是 B+Tree 结构</p>
</blockquote>
<p>为什么使用索引?</p>
<blockquote>
<p>如果不使用索引,数据会零散的保存在磁盘块中,磁盘块大小(4-8kb),查询数据时需要挨个遍历每一个磁盘块,直到找到数据为止,使用索引之后会在磁盘中将数据以树状结构进行保存,查询数据时从树状结构中进行查询,可以大大降低磁盘块的访问数量,从而提高查询速度</p>
</blockquote>
<p>索引是越多越好吗?</p>
<blockquote>
<p>索引会占用磁盘空间,所以创建时需谨慎,根据查询需求来决定创建什么索引.</p>
</blockquote>
<p>有索引就一定好吗?</p>
<blockquote>
<p>索引需要建立在大量数据的表中,如果数据量不够大,有可能会降低查询效率</p>
</blockquote>
</blockquote>
<ol>
<li>索引内部原理图
<img src="mysqlFiles/01.png" /></li>
<li>
索引的分类(了解)
<ol>
<li>聚集索引(聚簇索引):数据保存在树状结构中,一张表只有一个聚集索引,数据库会自动为添加了主键的表创建聚集索引.</li>
<li>非聚集索引: 树状结构中没有数据,保存的是磁盘块的地址.</li>
</ol>
</li>
<li>
如何创建索引(非聚集索引)
<ol>
<li>自己创建的索引都是非聚集索引,因为聚集索引数据库会自动创建.</li>
<li>格式: create index 索引名 on 表名(字段名[(长度)]);  长度是指创建的索引使用指定字段的前多个少字符,比如title,太长了,只需要前面5个字符,比如笔记本电脑.</li>
<li>创建索引之前先查询看时间 1.06秒   select * from item2 where title='100';</li>
<li>创建title索引  create index index_title on item2(title); 再次查询,看时间 0.03 提高30多倍  select * from item2 where title='100';</li>
</ol>
</li>
<li>查看索引: show index from item2;</li>
<li>删除索引: drop index index_title on item2; 或者 alter table user drop index user_name_index;</li>
<li>复合索引: 创建索引的时候添加多个字段,这种索引称为复合索引. 什么时候使用复合索引?当频繁使用多个字段作为查询条件的时候使用复合索引.创建格式: create index index_title_price on item2(title,price); 创建表时添加索引: create table t_index(id int,age int,index index_age(age));</li>
<li>explain解释查询语句</li>
</ol>
<pre><code>1)可能使用的索引
2)选择使用的索引
3)索引数据的宽度
4)扫描的行数
</code></pre>

<p>explain 查看select语句使用的索引，和扫描的数据行数.Explain select * from user where id=7745723;</p>
<p><img src="mysqlFiles/02.png" /></p>
<p>alter table user add primary key(id);explain select * from user where id=7745723;</p>
<p><img src="mysqlFiles/03.png" /></p>
<p><strong>索引总结</strong></p>
<pre><code>1)  索引会占磁盘空间,不是越多越好
2)  数据量小的表不要创建索引
3)  主键会自动创建聚集索引
4)  对经常出现在 where/order by/distinct后面的字段创建索引可以提高效率,效果更好
5)  不要在修改太频繁的表中创建索引
6)  Select xxx from xxx where username like '%ab' 不使用索引,where username like 'ab%'  使用索引
7)  当给username,password创建组合索引时,where username='abc' and password='123'使用索引, where username='abc'使用索引. where password='123' 不使用组合索引
</code></pre>

<h2>10.建表语句</h2>
<p><strong>员工部门表</strong></p>
<pre><code>create table emp(
EMPNO int(4) primary key,
ENAME varchar(10) not null,
JOB varchar(9),
MGR int(4),
HIREdate date,
SAL double(7,2),
COMM double(7,2),
DEPTNO int(4)
);

create table dept(
DEPTNO int(4) primary key,
DNAME varchar(14) not null unique,
LOC varchar(13)
);

insert into dept VALUES (10,'ACCOUNTING','NEW YORK');
insert into dept VALUES (20,'RESEARCH','DALLAS');
insert into dept VALUES (30,'SALES','CHICAGO');
insert into dept VALUES (40,'OPERATIONS','BOSTON');


insert into emp VALUES
(7369,'SMITH','CLERK',7902,str_to_date('17-12-1980','%d-%m-%Y'),800,null,20);
insert into emp VALUES
(7499,'ALLEN','SALESMAN',7698,str_to_date('20-2-1981','%d-%m-%Y'),1600,300,30);
insert into emp VALUES
(7521,'WARD','SALESMAN',7698,str_to_date('22-2-1981','%d-%m-%Y'),1250,500,30);
insert into emp VALUES
(7566,'JONES','MANAGER',7839,str_to_date('2-4-1981','%d-%m-%Y'),2975,NULL,20);
insert into emp VALUES
(7654,'MARTIN','SALESMAN',7698,str_to_date('28-9-1981','%d-%m-%Y'),1250,1400,30);
insert into emp VALUES
(7698,'BLAKE','MANAGER',7839,str_to_date('1-5-1981','%d-%m-%Y'),2850,NULL,30);
insert into emp VALUES
(7782,'CLARK','MANAGER',7839,str_to_date('9-6-1981','%d-%m-%Y'),2450,NULL,10);
insert into emp VALUES
(7839,'KING','PRESIDENT',NULL,str_to_date('17-11-1981','%d-%m-%Y'),5000,NULL,10);
insert into emp VALUES
(7844,'TURNER','SALESMAN',7698,str_to_date('8-9-1981','%d-%m-%Y'),1500,0,30);
insert into emp VALUES
(7900,'JAMES','CLERK',7698,str_to_date('3-12-1981','%d-%m-%Y'),950,NULL,30);
insert into emp VALUES
(7902,'FORD','ANALYST',7566,str_to_date('3-12-1981','%d-%m-%Y'),3000,NULL,20);
insert into emp VALUES
(7934,'MILLER','CLERK',7782,str_to_date('23-1-1982','%d-%m-%Y'),1300,NULL,10);

commit;
</code></pre>

<p><strong>商品,商品分类表</strong></p>
<pre><code>DROP TABLE IF EXISTS `t_item`;

CREATE TABLE `t_item` (
  `id` varchar(200) NOT NULL COMMENT '商品id',
  `category_id` bigint(20) DEFAULT NULL COMMENT '分类id',
  `item_type` varchar(100) DEFAULT NULL COMMENT '商品系列',
  `title` varchar(100) DEFAULT NULL COMMENT '商品标题',
  `sell_point` varchar(150) DEFAULT NULL COMMENT '商品卖点',
  `price` bigint(20) DEFAULT NULL COMMENT '商品单价',
  `num` int(10) DEFAULT NULL COMMENT '库存数量',
  `barcode` varchar(30) DEFAULT NULL COMMENT '条形码',
  `image` varchar(500) DEFAULT NULL COMMENT '图片路径',
  `status` int(1) DEFAULT '1' COMMENT '商品状态  1：上架   2：下架   3：删除',
  `priority` int(10) DEFAULT NULL COMMENT '显示优先级',
  `created_time` datetime DEFAULT NULL COMMENT '创建时间',
  `modified_time` datetime DEFAULT NULL COMMENT '最后修改时间',
  `created_user` varchar(50) DEFAULT NULL COMMENT '创建人',
  `modified_user` varchar(50) DEFAULT NULL COMMENT '最后修改人',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


INSERT INTO `t_item` VALUES 
('10000000',238,'牛皮纸记事本','广博(GuangBo)10本装40张A5牛皮纸记事本子日记本办公软抄本GBR0731','经典回顾！超值特惠！',23,99999,NULL,'/images/portal/00GuangBo1040A5GBR0731/collect.png',1,53,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000001',238,'牛皮纸记事本','广博(GuangBo)10本装40张A5牛皮纸记事本子日记本办公软抄本GBR0731','经典回顾！超值特惠！',23,99999,NULL,'/images/portal/00GuangBo1040A5GBR0731/collect.png',1,62,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000002',238,'皮面日程本','广博(GuangBo)皮面日程本子 计划记事本效率手册米色FB60322','经典回顾！超值特惠！',46,99999,NULL,'/images/portal/001GuangBo)FB60322/collect.png',1,49,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('100000021',238,'皮面日程本','广博(GuangBo)皮面日程本子 计划记事本效率手册蓝色FB60321','经典回顾！超值特惠！',22,99999,NULL,'/images/portal/001GuangBo)FB60322/collect.png',1,73,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000003',238,'记事本日记本笔记本','广博(GuangBo)16K115页线圈记事本子日记本文具笔记本图案随机','经典回顾！超值特惠！',13,99999,NULL,'/images/portal/01GuangBo16K115FB60506/collect.png',1,58,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000004',241,'计算器','得力（deli）1548A商务办公桌面计算器 太阳能双电源','经典回顾！超值特惠！',58,99999,NULL,'/images/portal/002calculator1548A/collect.png',1,42,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000005',241,'圆珠笔','施耐德（Schneider） K15 经典款圆珠笔 (5支混色装)','经典回顾！超值特惠！',29,99999,NULL,'/images/portal/03SchneiderK15/collect.png',1,36,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000006',236,'票据网格拉链袋','三木(SUNWOOD) C4523 票据网格拉链袋/文件袋 12个装 颜色随机','经典回顾！超值特惠！',28,99999,NULL,'/images/portal/04_SUNWOODC452312/collect.png',1,53,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000007',163,'燃 7000经典版','戴尔Dell 燃700金色','下单赠12000毫安移动电源',32999,99999,NULL,'/images/portal/11DELLran7000gold/collect.png',1,59,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000008',163,'燃 7000经典版','戴尔Dell 燃700R1605银色','仅上海，广州，沈阳仓有货！预购从速！',4549,99999,NULL,'/images/portal/11DELLran7000R1605Ssilvery/collect.png',1,32,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000009',163,'燃 7000学习版','戴尔Dell 燃700金色','下单赠12000毫安移动电源',39929,99999,NULL,'/images/portal/11DELLran7000gold/collect.png',1,84,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000010',163,'燃 7000学习版','戴尔Dell 燃700R1605银色','仅上海，广州，沈阳仓有货！预购从速！',5559,99999,NULL,'/images/portal/11DELLran7000R1605Ssilvery/collect.png',1,21,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000011',163,'燃 7000高配版','戴尔Dell 燃700金色','下单赠12000毫安移动电源',3994,99999,NULL,'/images/portal/11DELLran7000gold/collect.png',1,56,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000012',163,'燃 7000高配版','戴尔Dell 燃700R1605银色','仅上海，广州，沈阳仓有货！预购从速！',6559,99999,NULL,'/images/portal/11DELLran7000R1605Ssilvery/collect.png',1,16,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000013',238,'A5优品商务笔记本','齐心（COMIX）C5902 A5优品商务笔记本子记事本日记本122张','下单即送10400毫安移动电源！再赠手机魔法盒！',41,99999,NULL,'/images/portal/02COMIXC5902A5122blue/collect.png',1,10,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000014',163,'XPS13-9360','戴尔(DELL)XPS13-9360-R1609 13.3','仅上海，广州，沈阳仓有货！预购从速！',4600,99999,NULL,'/images/portal/12(DELL)XPS13gold/collect.png',1,1,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000015',163,'XPS13-9360','戴尔(DELL)XPS13-9360-R1609 13.3','仅上海，广州，沈阳仓有货！预购从速！',4601,99999,NULL,'/images/portal/12DELLXPS13-silvery/collect.png',1,73,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000016',163,'XPS13-9360','戴尔(DELL)XPS13-9360-R1609 13.3','仅上海，广州，沈阳仓有货！预购从速！',4602,99999,NULL,'/images/portal/12(DELL)XPS13gold/collect.png',1,64,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000017',163,'XPS13-9360','戴尔(DELL)XPS13-9360-R1609 13.3','仅上海，广州，沈阳仓有货！预购从速！',4604,99999,NULL,'/images/portal/12DELLXPS13-silvery/collect.png',1,100,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000018',163,'XPS13-9360','戴尔(DELL)XPS13-9360-R1609 13.3','仅上海，广州，沈阳仓有货！预购从速！',4605,99999,NULL,'/images/portal/12(DELL)XPS13gold/collect.png',1,7,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000019',163,'XPS13-9360','戴尔(DELL)XPS13-9360-R1609 13.3','仅上海，广州，沈阳仓有货！预购从速！',4899,99999,NULL,'/images/portal/12DELLXPS13-silvery/collect.png',1,34,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000020',163,'IdeaPad310低配版','联想（Lenovo）IdeaPad310低配版','清仓！仅北京，武汉仓有货！',5119,99999,NULL,'/images/portal/13LenovoIdeaPad310_black/collect.png',1,50,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000021',163,'IdeaPad310低配版','联想（Lenovo）IdeaPad310低配版','清仓！仅北京，武汉仓有货！',5129,99999,NULL,'/images/portal/13LenovoIdeaPad310_silvery/collect.png',1,48,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000022',163,'IdeaPad310经典版','联想（Lenovo）IdeaPad310经典版','清仓！仅北京，武汉仓有货！',5119,99999,NULL,'/images/portal/13LenovoIdeaPad310_black/collect.png',1,90,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000023',163,'IdeaPad310经典版','联想（Lenovo）IdeaPad310经典版','清仓！仅北京，武汉仓有货！',5129,99999,NULL,'/images/portal/13LenovoIdeaPad310_silvery/collect.png',1,6,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000024',163,'IdeaPad310高配版','联想（Lenovo）IdeaPad310高配版','清仓！仅北京，武汉仓有货！',5119,99999,NULL,'/images/portal/13LenovoIdeaPad310_black/collect.png',1,60,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000025',163,'IdeaPad310高配版','联想（Lenovo）IdeaPad310高配版','清仓！仅北京，武汉仓有货！',5129,99999,NULL,'/images/portal/13LenovoIdeaPad310_silvery/collect.png',1,80,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000026',163,'YOGA710','联想（Lenovo）YOGA710 14英寸触控笔记本（i7-7500U 8G 256GSSD 2G独显 全高清IPS 360°翻转 正版office）金','【0元献礼】好评过万，销量传奇！经典蓝光电视，独有自然光技术专利，过大年带最好的回家！【0元白条试用，1001个拜年计划】',59999,99999,NULL,'/images/portal/14LenovoYOGA710 _gold/collect.png',1,19,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000027',163,'YOGA710','联想（Lenovo）YOGA710 14英寸触控笔记本（i7-7500U 8G 256GSSD 2G独显 全高清IPS 360°翻转 正版office）银','【0元献礼】好评过万，销量传奇！经典蓝光电视，独有自然光技术专利，过大年带最好的回家！【0元白条试用，1001个拜年计划】',59999,99999,NULL,'/images/portal/14LenovoYOGA710 _silvery/collect.png',1,55,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000028',163,'310低配版','联想（Lenovo）小新310低配版','清仓！仅北京，武汉仓有货！',4939,99999,NULL,'/images/portal/15Lenovo_xiaoxin_310_black/collect.png',1,19,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000029',163,'310低配版','联想（Lenovo）小新310低配版','清仓！仅北京，武汉仓有货！',4839,99999,NULL,'/images/portal/15Lenovo_xiaoxin_310_silvery/collect.png',1,27,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000030',163,'310经典版','联想（Lenovo）小新310经典版','清仓！仅北京，武汉仓有货！',4739,99999,NULL,'/images/portal/15Lenovo_xiaoxin_310_black/collect.png',1,78,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000031',163,'310经典版','联想（Lenovo）小新310经典版','清仓！仅北京，武汉仓有货！',4639,99999,NULL,'/images/portal/15Lenovo_xiaoxin_310_silvery/collect.png',1,9,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000032',163,'310高配版','联想（Lenovo）小新310高配版','清仓！仅北京，武汉仓有货！',4539,99999,NULL,'/images/portal/15Lenovo_xiaoxin_310_black/collect.png',1,9,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000033',163,'310高配版','联想（Lenovo）小新310高配版','清仓！仅北京，武汉仓有货！',4439,99999,NULL,'/images/portal/15Lenovo_xiaoxin_310_silvery/collect.png',1,18,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000034',163,'YOGA900','联想（Lenovo）YOGA900绿色','青春的活力 清新漂亮高端大气上档次',5200,99999,NULL,'/images/portal/16LenovoYOGA900green/collect.png',1,63,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000035',163,'YOGA900','联想（Lenovo）YOGA900粉色','青春的活力 清新漂亮高端大气上档次',5200,99999,NULL,'/images/portal/16LenovoYOGA900pink/collect.png',1,62,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000036',163,'YOGA900','联想（Lenovo）YOGA900红色','青春的活力 清新漂亮高端大气上档次',5200,99999,NULL,'/images/portal/16LenovoYOGA900red/collect.png',1,21,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000037',163,'小新13旗舰版','联想(Lenovo)小新Air13 Pro 13.3英寸14.8mm超轻薄笔记本电脑','青春的活力 青年专属',6439,99999,NULL,'/images/portal/17Lenovo)xiaoxinAir13Pro_gold/collect.png',1,16,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000038',163,'小新13旗舰版','联想(Lenovo)小新Air13 Pro 13.3英寸14.8mm超轻薄笔记本电脑','青春的活力 青年专属',6439,99999,NULL,'/images/portal/17Lenovo)xiaoxinAir13Pro_silvery/collect.png',1,17,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000039',163,'XPS15','戴尔(DELL) XPS15 银色','限时特价！好评过万条优秀产品！',3333,99999,NULL,'/images/portal/18(DELL)XPS15_silvery/collect.png',1,37,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('100000391',163,'XPS15','戴尔(DELL) XPS15 金色','限时特价！好评过万条优秀产品！',3333,99999,NULL,'/images/portal/18(DELL)XPS15_silvery/collect.png',1,81,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000040',163,'DELL 15MF Pro','戴尔(DELL)魔方15MF Pro-R2505TSS灵越','15.6英寸二合一翻转笔记本电脑 (i5-7200U 8GB 1TB IPS Win10)触控银',4443,99999,NULL,'/images/portal/19DELL15MF Pro/collect.png',1,35,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('100000401',163,'DELL 15MF Pro','戴尔(DELL)魔方15MF Pro-R2505TSS灵越','15.6英寸二合一翻转笔记本电脑 (i5-7200U 8GB 1TB IPS Win10)触控白',4443,99999,NULL,'/images/portal/19DELL15MF Pro/collect.png',1,86,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('100000402',163,'DELL 15MF Pro','戴尔(DELL)魔方15MF Pro-R2505TSS灵越','15.6英寸二合一翻转笔记本电脑 (i7-7200U 8GB 512GB IPS Win10)触控银',6443,99999,NULL,'/images/portal/19DELL15MF Pro/collect.png',1,84,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('100000403',163,'DELL 15MF Pro','戴尔(DELL)魔方15MF Pro-R2505TSS灵越','15.6英寸二合一翻转笔记本电脑 (i7-7200U 8GB 512GB IPS Win10)触控白',6443,99999,NULL,'/images/portal/19DELL15MF Pro/collect.png',1,63,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000041',163,'DELL XPS15-9550','戴尔(DELL) XPS15升级版 ','15.6英寸二合一翻转笔记本电脑 (i5-7200U 8GB 1TGB IPS Win10)触控',8443,99999,NULL,'/images/portal/20DellXPS15-9550/collect.png',1,61,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('100000411',163,'DELL XPS15-9550','戴尔(DELL) XPS15升级版 ','15.6英寸二合一翻转笔记本电脑 (i5-7200U 8GB 256GB IPS Win10)触控',8443,99999,NULL,'/images/portal/20DellXPS15-9550/collect.png',1,60,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('100000412',163,'DELL XPS15-9550','戴尔(DELL) XPS15升级版 ','15.6英寸二合一翻转笔记本电脑 (i7-7200U 8GB 1TB IPS Win10)触控',8443,99999,NULL,'/images/portal/20DellXPS15-9550/collect.png',1,13,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('100000413',163,'DELL XPS15-9550','戴尔(DELL) XPS15升级版 ','15.6英寸二合一翻转笔记本电脑 (i7-7200U 8GB 256GB IPS Win10)触控',8443,99999,NULL,'/images/portal/20DellXPS15-9550/collect.png',1,83,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000042',163,'ThinkPad New s1','联想ThinkPad New S2（01CD） i5 6代 红色','经典回顾！超值特惠！',4399,99999,NULL,'/images/portal/21ThinkPad_New_S1/collect.png',1,99,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('100000421',163,'ThinkPad New s1','联想ThinkPad New S2（01CD） i7 6700 红','经典回顾！超值特惠！',6399,99999,NULL,'/images/portal/21ThinkPad_New_S1/collect.png',1,74,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('100000422',163,'ThinkPad New s1','联想ThinkPad New S2（01CD） i5 6代 黄','经典回顾！超值特惠！',4399,99999,NULL,'/images/portal/21ThinkPad_New_S1/collect.png',1,23,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('100000424',163,'ThinkPad New s1','联想ThinkPad New S2（01CD） i5 6代 蓝','经典回顾！超值特惠！',4399,99999,NULL,'/images/portal/21ThinkPad_New_S1/collect.png',1,87,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('100000425',163,'ThinkPad New s1','联想ThinkPad New S2（01CD） i7 6700 蓝','经典回顾！超值特惠！',6399,99999,NULL,'/images/portal/21ThinkPad_New_S1/collect.png',1,59,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000043',917,'书包 bag','乐尚书包 电脑包 bag黑色','给你满载而归的喜悦！',89,99999,NULL,'/images/portal/22_LEXON_LNE6025B06T/collect.png',1,12,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin'),
('10000044',917,'书包 bag','乐尚书包 电脑包 bag粉色','给你满载而归的喜悦！',89,99999,NULL,'/images/portal/22_LEXON_LNE6025B06T/collect.png',1,62,'2017-10-25 15:08:55','2017-10-25 15:08:55','admin','admin');




DROP TABLE IF EXISTS `t_item_category`;

CREATE TABLE `t_item_category` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `parent_id` bigint(20) DEFAULT NULL COMMENT '父分类id',
  `name` varchar(150) DEFAULT NULL COMMENT '名称',
  `status` int(1) DEFAULT '1' COMMENT '状态   1：正常   2：删除',
  `sort_order` int(4) DEFAULT NULL COMMENT '排序号',
  `is_parent` tinyint(1) DEFAULT NULL COMMENT '是否是父分类   1：是  0：否',
  `created_time` datetime DEFAULT NULL COMMENT '创建时间',
  `modified_time` datetime DEFAULT NULL COMMENT '最后修改时间',
  `created_user` varchar(50) DEFAULT NULL COMMENT '创建人',
  `modified_user` varchar(50) DEFAULT NULL COMMENT '最后修改人',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1183 DEFAULT CHARSET=utf8;



INSERT INTO `t_item_category` VALUES 
(163,162,'笔记本',1,1,0,'2017-10-25 15:00:55','2017-10-25 15:00:55','admin','admin'),
(236,229,'文件管理',1,7,0,'2017-10-25 15:00:55','2017-10-25 15:00:55','admin','admin'),
(238,229,'本册/便签',1,9,0,'2017-10-25 15:00:55','2017-10-25 15:00:55','admin','admin'),
(241,229,'笔类',1,12,0,'2017-10-25 15:00:55','2017-10-25 15:00:55','admin','admin'),
(917,913,'双肩包',1,4,0,'2017-10-25 15:00:55','2017-10-25 15:00:55','admin','admin');
</code></pre>

<h2>11.案例</h2>
<pre><code>1.案例：查询没有上级领导的员工的编号，姓名，工资:
select empno,ename,sal from emp where mgr is null;
2.案例：查询emp表中没有奖金的员工的姓名，职位，工资，以及奖金
select ename,job,sal from emp where comm is null;
3.案例：查询含有上级领导的员工的姓名，工资以及上级领导的编号
select ename,sal,mgr from emp where mgr is not null;
4.案例：查询emp表中名字以‘S’开头的所有员工的姓名
select ename from emp where ename like 'S%';
5.案例：查询倒数的第2个字符是‘E’的员工的姓名
select ename from emp where ename like '%E_';
6.案例：查询emp表中员工的名字中包含‘A’的员工的姓名
select ename from emp where ename like '%A%';
7.案例：查询emp表中名字不是以'K'开头的员工的所有信息
select * from emp where ename not like 'K%';
8.案例：做文员的员工人数（job 中 含有 CLERK 的）
select count(*) from emp where job = 'CLERK'; 注:这儿的clerk没区分大小写.
9.案例：销售人员 job: SALESMAN 的最高薪水
select max(sal) from emp where job='SALESMAN' ;
10.案例：最早和最晚入职时间
select max(hiredate),min(hiredate) from emp;
11.案例:查询类别 163的商品总库存量
select sum(num) from t_item where category_id=163;
12.案例：查询商品价格不大于100的商品名称列表
select title,price from t_item where price &lt;=100;
13.案例：查询品牌是联想,且价格在40000以上的商品名称和价格
select title,price from t_item where title like '%联想%' and price&gt;40000;
14.案例：查询品牌是三木、广博、齐心的商品名称和价格
select title,price from t_item where title like '%三木%' or title like '%广博%' or title like '%齐心%';
15.案例：查询品牌不是联想、戴尔的商品名称和价格
select title,price from t_item where title not like '%联想%' and title not like '%戴尔%';  注:不能使用or,否则报错.
16. 案例：查询品牌是末尾字符是'力'的商品的名称和价格
select title,price from t_item where title like '%_力%';
17: 案例：查询emp表中员工的编号，姓名，职位，工资，并且工资在1000~2000之间
select empno,ename,job,sal from emp where sal between 1000 and 2000;
18: 案例：查询emp表中员工在10号部门，并且含有上级领导的员工的姓名，职位，上级领导编号以及所属部门的编号
select ename,job,mgr,deptno from emp where deptno=10 and mgr is not null;
19:案例：查询emp表中名字中包含'E'，并且职位不是MANAGER的员工的编号，姓名，职位，以及工资。
select empno,ename,job,sal from emp where ename like '%E%' and job!='MANAGER';
20: 案例：查询emp表中10号部门或者20号部门中员工的编号，姓名，所属部门的编号
select empno,ename,deptno from emp where deptno in (10,20);
21: 案例：查询emp表中没有奖金或者名字的倒数第2个字母不是T的员工的编号，姓名，职位以及奖金
select empno,ename,job,comm from emp where comm is null or ename not like '%T_';
22. 案例：查询工资高于3000或者部门编号是30的员工的姓名，职位，工资，入职时间以及所属部门的编号
select * from emp where sal&gt;3000 or deptno=30;
23. 案例：查询emp表中所有的数据，然后根据部门的编号进行升序排列，如果部门编号一致，根据员工的编号进行降序排列
select * from emp order by deptno ,empno desc;
24. 案例：查询emp表中工资高于1000或者没有上级领导的员工的编号，姓名，工资，所属部门的编号，以及上级领导的编号，根据部门编号进行降序排列，如果部门编号一致根据工资进行升序排列。
select empno,ename,sal,deptno,mgr from emp where sal&gt;1000 or mgr is null order by deptno desc,sal;
25. 案例：查询emp表中员工的人数，工资的总和，平均工资，奖金的最大值，奖金的最小值,并且对返回的列起别名
select count(*) '人数',sum(sal) '工资总和',avg(sal) '平均工资',max(comm) '最高奖金',min(comm) '最低奖金' from emp;
以每XXX开头的一般都要group by xxx
26. 查询每个部门的最高工资
select deptno,max(sal) from emp group by deptno;
27. 查询每个部门工资大于2000的有多少人
select deptno,count(*) from emp where sal&gt;2000 group by deptno ;
28. 案例：查询emp表中每个部门的编号，人数，工资总和，最后根据人数进行升序排列，如果人数一致，根据工资总和降序排列
select deptno,count(*) c,sum(sal) sum from emp group by deptno order by c,sum desc;
29. 案例：查询含有上级领导的员工，每个职业的人数，工资的总和，平均工资，最低工资，最后根据人数进行降序排列，如果人数一致，根据平均工资进行升序排列
select job,count(*) c,sum(sal),avg(sal) avg,min(sal) from emp where mgr is not null group by job order by c desc,avg;
30. 查询每个部门,每个主管的手下人数
select deptno,mgr,count(*) from emp where mgr is not null group by deptno,mgr;
31. 每年入职的人数
select extract(year from hiredate) year,count(*) from emp group by year;
------------------------------------------------------------------
32. 查询每个部门的平均工资要求平均工资大于2000;
select deptno,avg(sal) avg from emp group by deptno having avg&gt;2000;
33. 查询所有分类的所对应的库存总量,要求库存总量高于100000
select category_id,sum(num) sum from t_item group by category_id having sum&gt;100000;
34. 查询每个部门中名字里面包含a的员工的平均工资,只显示平均工资高于2000的
select deptno,avg(sal) avg from emp where ename like '%a%' group by deptno having avg&gt;2000;
35. 查询emp表,名字不是以k开头的信息,每个部门的最低工资高于1000的部门编号,工资总和,平均工资以及最低工资,根据平均工资进行排序
select deptno,sum(sal),avg(sal) avg,min(sal) min from emp where ename not like 'k%' group by deptno having min&gt;1000 order by avg;
36. 查询emp表中部门编号是10,30的部门员工,每个职业中的最高工资低于5000的职业名称,人数,平均工资,最高工资,根据人数排序,如果人数一致,根据最高工资进行降序排序
select job,count(*) c,avg(sal),max(sal) max from emp where deptno in (10,30) group by job having max&lt;5000 order by c,max desc;
37. 查询emp表,工资在1000-3000的员工信息,每个部门的编号,工资总和,平均工资,过滤掉平均工资低于2000的部门,平均工资升序排序,如果一致则工资总和降序
select deptno,sum(sal) sum,avg(sal) avg from emp where sal between 1000 and 3000 group by deptno having avg&gt;=2000 order by avg,sum desc;
------------------------------------------------------------------
38. 查询拿最高工资的员工姓名
select ename from emp where sal=(select max(sal) from emp);
39. 查询工资 高于平均工资的员工姓名和工资
select ename,sal from emp where sal&gt;(select avg(sal) from emp);
40. 查询最后入职的员工信息
select * from emp where hiredate=(select max(hiredate) from emp);
41. 查询出有员工的部门信息
select * from dept where deptno in(select distinct deptno from emp);
42. 查询工资高于 20号部门里面最高工资的 所有员工信息
select * from emp where sal&gt;(select max(sal) from emp where deptno=20);
43. 查询和jones一样工作的员工信息
select * from emp where job=(select job from emp where ename='jones') and ename!='jones';
44. 查询部门平均工资最高的部门信息
select * from dept where deptno in (select deptno from emp group by deptno having avg(sal)=(select avg(sal) from emp group by deptno order by avg(sal) desc limit 0,1));
------------------------------------------------------------------
45. 查询每一个员工姓名和所对应的部门名称
select e.ename,d.dname from emp e join dept d on e.deptno=d.deptno;
46. 查询每个商品的标题,商品单价,商品分类名称
select item.title,item.price,category.name from t_item item join t_item_category category on item.category_id=category.id;
47. 查询在new york工作的所有员工信息
select e.* from emp e join dept d on e.deptno=d.deptno where d.loc='new york';
48. 查询所有员工的名字和对应的部门名(使用左外)
select e.ename,d.dname from emp e left join dept d on e.deptno=d.deptno;
49. 每个部门中，每个主管的手下人数
select mgr,count(*) from emp where mgr is not null group by deptno,mgr;
50. 只有一个下属的主管信息
select * from emp where empno in(select mgr from emp where mgr is not null group by mgr having count(*)=1);
51. 平均工资最高的部门编号
select deptno from emp group by deptno order by avg(sal) desc limit 0,1;
52. 下属人数最多的人，查询其个人信息(易错)
select * from emp where empno in(select mgr  from emp group by mgr having count(*)=(select count(*) from emp group by mgr order by count(*) desc limit 0,1));
53. 最后入职的员工信息
select * from emp where hiredate=(select max(hiredate) from emp);
54. 按城市分组，计算每个城市的员工数量
select d.loc,count(*) from emp e join dept d on e.deptno=d.deptno group by d.loc;
55. 查询员工信息和他的主管姓名
select e.*,m.ename from emp e join emp m on e.mgr=m.empno;
56. 工信息，员工主管名字，部门名
select e.*,m.ename,d.dname from emp e join emp m on e.mgr=m.empno join dept d on e.deptno=d.deptno; 
57. 案例：查询emp表中名字中没有字母'K'的所有员工的编号，姓名，职位以及所在部门的编号，名称，地址. 注:查询的是所有员工 所以使用左外连接
select e.empno,e.ename,e.job,d.deptno,d.dname,d.loc from emp e left   join dept d on e.deptno=d.deptno where e.ename not like '%k%';

表设计之多对多的练习:
练习: 创建老师(id,name)和学生表(id,name),创建老师和学生关系表t_s(tid,sid)
        create table teacher(id int primary key auto_increment,name varchar(10));
        create table student(id int primary key auto_increment,name varchar(10));
        create table t_s(tid int,sid int);
insert into teacher values(null,'张一'),(null,'张三'),(null,'苍老师');
        insert into student values(null,'张二'),(null,'张四'),(null,'波多野结衣');
1.关系表中插入数据张一是张二和波多野结衣的老师, 张三是张四的老师,苍老师是所有人的老师
    insert into t_s values(1,1),(1,3),(2,2),(3,1),(3,2),(3,3);
2. 查询老师和学生表中 每个学生名子和对应的老师名字
    select s.name,t.name
    from teacher t join t_s ts
    on t.id=ts.tid
    join student s
    on ts.sid=s.id;
3. 查询苍老师的所有学生姓名
    select s.name
    from teacher t join t_s ts
    on t.id=ts.tid
    join student s
    on ts.sid=s.id
    where t.name='苍老师';
4. 查询波多野结衣的所有老师
    select t.name
    from teacher t join t_s ts
    on t.id=ts.tid
    join student s
    on ts.sid=s.id
    where s.name='波多野结衣';
 子查询方式:
    select name from teacher where id in(select tid from t_s where sid=(select id from student where name='波多野结衣'));
权限管理表的设计:
1. 创建db5数据库并use,创建5张表: user(id,name),role(id,name),module(id,name),用户和角色关系表u_r(uid,rid),
create table user(id int primary key auto_increment,name varchar(10));
        create table role(id int primary key auto_increment,name varchar(10));
        create table module(id int primary key auto_increment,name varchar(10));
        create table u_r(uid int,rid int);
        create table r_m(rid int,mid int);
2.  插入数据user:刘德华,张学友,凤姐 role:男游客,男会员,女游客,女管理员 module:男浏览,男发帖,女浏览,女发帖,女删帖
insert into user values(null,'刘德华'),(null,'张学友'),(null,'凤姐');
        insert into role values(null,'男游客'),(null,'男会员'),(null,'女游客'),(null,'女管理员');
        insert into module values(null,'男浏览'),(null,'男发帖'),(null,'女浏览'),(null,'女发帖'),(null,'       女删帖');
3. 建立关系 刘德华是男游客 张学友是男会员,凤姐是女游客和男会员, 男游客对应男浏览 男会员对应男浏览和男发帖 女游客对应女浏览,女管理员对应女浏览女发帖和女删帖
    insert into u_r values(1,1),(2,2),(3,3),(3,2);
        insert into r_m values(1,1),(2,1),(2,2),(3,3),(4,3),(4,4),(4,5);
1) 查询每个用户对应的所有权限
     select u.name,m.name
        from user u join u_r ur
        on u.id=ur.uid
        join r_m rm
        on ur.rid=rm.rid
        join module m
        on rm.mid=m.id;
2) 查询刘德华对应的所有权限
    select u.name,m.name
        from user u join u_r ur
        on u.id=ur.uid
        join r_m rm
        on ur.rid=rm.rid
        join module m
        on rm.mid=m.id
        where u.name='刘德华';
3) 有男发帖的用户都有哪些
    select u.name,m.name
        from user u join u_r ur
        on u.id=ur.uid
        join r_m rm
        on ur.rid=rm.rid
        join module m
        on rm.mid=m.id
        where m.name='男发帖';

面试题 需求说明:2018年狗年小微收到了很多红包,有亲戚的红包,朋友的红包,同事的红包.红包里有的是现金,有的是微信红包,支付宝红包.为了礼尚往来,小微还发了一些红包给弟弟妹妹,朋友,同事.请设计表帮小微统计:
提示:至少包含2张表.(其中包含一张红包交易流水表,交易流水表中不能包含交易双方的姓名)
1.请写出表名称和包含的字段名称.举例:
表:交易流水表 Trade
字段:交易号 TradeID ,  交易时间TradeTime , 交易金额 TradeAmount……
    create table trade(id int primary key auto_increment,time date,money double,type varchar(5),pid int);
        create table person(id int primary key auto_increment,name varchar(10),gender varchar(5),rel varchar(5));
2.统计从2018年春节(2月15日)到现在收益(收益=收入-支出)多少元红包?
SQL: 
select sum(money) from trade where time&gt;str_to_date('2018年2月15号','%Y年%m月%d号');
3.查询从2018年春节(2月15日)到现在红包大于100元的所有女性亲戚的名字和对应的红包金额.
SQL:
  select p.name,t.money
    from trade t join person p
    on t.pid=p.id
    where t.money not between -100 and 100
    and p.gender='女'
    and p.rel='亲戚'
    and t.time&gt;str_to_date('2018年2月15号','%Y年%m月%d号');
4.查询统计,现金丶支付宝丶微信三个平台分别收到的红包总金额.
SQL:
  select type,sum(money) from trade
    where money&gt;0
    group by type;
</code></pre>

<h2>12.FAQ</h2>
<pre><code>1. windows电脑出现命令行中无法插入中文数据的解决方案: 在命令行中先登录mysql 然后执行 
2. set names gbk; 通知mysql数据库服务器,客户端(命令行)的编码格式为gbk
2. 使用eclipse执行sql乱码问题: 在建立连接的时候修改url,在数据库名称的后面添加: ?useUnicode=true&amp;characterEncoding=UTF-8 
例如: jdbc:mysql://localhost:3306/db2?useUnicode=true&amp;characterEncoding=UTF-8
3. cmd命令行导出mysql数据库:mysqldump -uroot -p xxx&gt;xxx.sql,可指定导出的具体位置.
4. 导出sql文件到数据库:在终端中先登录mysql,在命令行下执行: source  文件的绝对路径
</code></pre>

<h2>13.数据库编程(补充)</h2>
<h3>13.1变量</h3>
<ol>
<li>
<p>运行环境变量,set character_set_client=gbk;只对当前会话有效.set global character_set_client=gbk;全局设置，永久生效,但是对已连接的会话无效，重新连接后才生效.</p>
<pre><code>show variables;
show variables like '%datadir%';
show variables like '%char%';
show variables like 'tx_isolation';
</code></pre>

</li>
<li>
<p>会话变量:在一次回话期间有效.
<code>set @v1=838;</code>    <code>select @v1;</code></p>
</li>
<li>
<p>局部变量:只能在它定义的局部代码块内部使用.</p>
<pre><code>begin
declare v2 int;
declare v3 int default 543;
set v2=6;
select v3;
end;
</code></pre>

</li>
</ol>
<h3>13.2存储过程</h3>
<h4>13.2.1创建存储过程</h4>
<pre><code>delimiter // 设置结束符
create procedure p1()
begin
   declare v1 int default 123;
   select v1;
end //
delimiter ; 结束符改回成分号
</code></pre>

<h4>13.2.2调用存储过程</h4>
<pre><code>call p1();
</code></pre>

<h4>13.2.3存储过程的参数</h4>
<ul>
<li>in       输入参数</li>
<li>out      输出参数</li>
<li>
<p>inout    既能输入也能输出</p>
<pre><code>delimiter //
create procedure p2(in a int, out b int)
begin
   set b=a*a;
end //
delimiter ;
call p2(2, @v1);
select @v1;
call p2(6, @v1);
select @v1;
</code></pre>

</li>
</ul>
<h4>13.2.4 查看存储过程</h4>
<pre><code>查看全部存储过程
show procedure status\G
查看db1库中的存储过程
show procedure status where db='db1'\G
show procedure status where name='p1'\G
查看创建代码
show create procedure p1\G
</code></pre>

<h4>13.2.5删除存储过程</h4>
<pre><code>drop procedure p1;
drop procedure if exists p1;
</code></pre>

<h4>13.2.6存储过程测试</h4>
<pre><code>同时保存学生数据和联系方式数据
并获得新生成的学生id
use db1;
drop procedure if exists save_stu;
delimiter // -- 修改结束符
create procedure save_stu
(in name varchar(20), -- 姓名
in tel varchar(20), -- 电话
out xid int) -- 向外输出学生id
begin
    declare v2 int;
-- 插入学生数据
insert into xuesheng(name)
values(name);
-- 获得自增id
set v2=last_insert_id();
-- 插入联系方式表
insert into lianxi(xs_id, tel)
values(v2, tel);
-- 设置输出参数
set xid=v2;
end //
delimiter ;
set names gbk;
call save_stu('张三', '2342345', @xid);
select * from xuesheng;
select * from lianxi;
select @xid;
</code></pre>

<h3>13.3流程控制</h3>
<ul>
<li>if</li>
<li>case</li>
<li>while</li>
<li>loop</li>
<li>repeat</li>
</ul>
<h4>13.3.1if</h4>
<pre><code>if 条件 then
   代码
end if;
if 条件 then
   代码1
else
   代码2
end if;
</code></pre>

<h4>13.3.2case</h4>
<pre><code>case
    when 条件1 then ...
    when 条件2 then ...
    else ...
end case;
case 变量或表达式
    when 值1 then ...
    when 值2 then ...
    else ...
end case;
</code></pre>

<h4>13.3.3分支测试</h4>
<pre><code>drop procedure if exists p1;
delimiter //
create procedure p1(in a int)
begin
   if a=1 then
      select '壹' c;
   else
      select '不是壹' c;
   end if;
   case a
      when 2 then select '贰' c;
      when 3 then select '叁' c;
      else select '不是贰叁' c;
   end case;
end //
delimiter ;
call p1(1);
call p1(2);
call p1(3);
call p1(4);
call p1(5);
</code></pre>

<h4>13.3.4while</h4>
<pre><code>while 执行条件 do
   代码
end while;
</code></pre>

<h4>13.3.5loop</h4>
<pre><code>a: loop
   代码
   if 条件 then
      leave a;
   else if;
end loop;
</code></pre>

<h4>13.3.6repeat</h4>
<pre><code>repeat
   代码
until 退出条件 end repeat;
</code></pre>

<h4>13.3.7循环测试</h4>
<pre><code>创建表
drop table if exists tb1;
create table tb1(a int);
创建存储过程，向tb1循环插入1到n，n条数据
drop procedure if exists p2;
delimiter //
create procedure p2(in n int)
begin
   declare i int; -- 1到n
   set i=1;
   while i&lt;=n do
      insert into tb1 values(i);
       set i=i+1;
   end while;
   set i=1;
   lp: loop
      insert into tb1 values(i);
      if i=5 then
         leave lp;
      end if;
      set i=i+1;
   end loop;
   set i=1;
   repeat
insert into tb1 values(i);
set i=i+1;
   until i&gt;n end repeat;
end //
delimiter ;
call p2(5);
select * from tb1;
</code></pre>

<h3>13.4函数</h3>
<ul>
<li>函数有返回值</li>
<li>select f(2)</li>
</ul>
<h4>13.4.1创建函数</h4>
<pre><code>delimiter //
create function f(a int)
returns int -- 声明函数返回的数据类型
begin
   declare r int;
   set r = a*a;
   return r; -- 返回计算结果数据
end //
delimiter ;
select f(2);
select a+f(a) from tb1;
</code></pre>

<h4>13.4.2查看函数</h4>
<pre><code>所有函数
show function status\G
db1库的函数
show function status where db='db1'\G
show function status where name='f'\G
函数创建代码
show create function f\G
</code></pre>

<h4>13.4.3删除函数</h4>
<pre><code>drop funcation f;
drop funcation if exists f;
</code></pre>

<h4>13.4.4存储过程、函数练习</h4>
<pre><code>    产生大量随机字符串，存入表中
    产生随机字符串的函数 fn_rand()
    drop function if exists fn_rand;
    delimiter //
    create function fn_rand(a int, b int)
    returns varchar(100)
    begin
       declare len int; -- 随机长度[a,b)
       declare s0 varchar(800) -- 备选字符
    default 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ的一是在不了有和人这中大为上个国我以要他时来用们生到作地于出就分对成会可主发年动同工也能下过子说产种面而方后多定行学法所民得经十三之进着等部度家电力里如水化高自二理起小物现实加量都两体制机当使点从业本去把性好应开它合还因由其些然前外天政四日那社义事平形相全表间样与关各重新线内数正心反你明看原又么利比或但质气第向道命此变条只没结解问意建月公无系军很情者最立代想已通并提直题党程展五果料象员革位入常文总次品式活设及管特件长求老头基资边流路级少图山统接知较将组见计别她手角期根论运农指几九区强放决西被干做必战先回则任取据处队南给色光门即保治北造百规热领七海口东导器压志世金增争济阶油思术极交受联什认六共权收证改清己美再采转更单风切打白教速花带安场身车例真务具万每目至达走积示议声报斗完类八离华名确才科张信马节话米整空元况今集温传土许步群广石记需段研界拉林律叫且究观越织装影算低持音众书布复容儿须际商非验连断深难近矿千周委素技备半办青省列习响约支般史感劳便团往酸历市克何除消构府称太准精值号率族维划选标写存候毛亲快效斯院查江型眼王按格养易置派层片始却专状育厂京识适属圆包火住调满县局照参红细引听该铁价严龙飞';
       declare s varchar(100) default '';-- 结果字符串
       declare i int default 0; -- 控制执行次数
       declare j int; -- 在备选字符串s0中随机定位
       -- 计算[a,b)范围的随机长度
       set len=truncate(a+(b-a)*rand(), 0);
    -- 随机产生len个随机字符
    while i&lt;len do
       -- 在 s0 中随机定位一个位置
       set j=
    truncate(1+char_length(s0)*rand(),0);
          -- s0中j位置开始的1个字符，连接到s中
          set s=concat(s, substring(s0, j, 1));
          -- i递增
          set i=i+1;
    end while;
    return s; -- 返回结果
    end //
    delimiter ;
    select fn_rand(2,6);
    select fn_rand(2,6);
    select fn_rand(2,6);
    select fn_rand(2,6);
    select fn_rand(2,6);
    内存表
    create table tm(
    a varchar(20)
    )engine=memory charset=utf8;
    磁盘表
    create table t(
    id int primary key auto_increment,
    a varchar(20)
    )engine=innodb charset=utf8;
    存储过程，产生n条数据保存到磁盘表t
    drop procedure if exists gen_data;
    delimiter //
    create procedure gen_data(in n int)
    begin
       declare i int default 0;
       while i&lt;n do
          insert into tm values(fn_rand(2,6));
          set i=i+1;
       end while;
       insert into t(a) select a from tm;
       delete from tm;
    end //
    delimiter ;
    call gen_data(10);
    select * from t where a like 'ab%';
    explain select * from t where a like 'ab%';
    创建索引
    create index t_a_index on t(a);
    select * from t where a like 'ab%';
    explain select * from t where a like 'ab%';
    select * from t where a like '%ab';
    explain select * from t where a like '%ab';
</code></pre>

<h3>13.5触发器</h3>
<p>在执行增删改时，可以触发一段代码执行</p>
<ul>
<li>
6个触发时间：
<ul>
<li>before insert</li>
<li>before update</li>
<li>before delete</li>
<li>after insert</li>
<li>after update</li>
<li>after delete</li>
</ul>
</li>
<li>一张表，最多可以创建6个触发器</li>
<li>
两个隐含对象
<ul>
<li>old   旧数据</li>
<li>new   新数据</li>
</ul>
</li>
<li>
insert
<ul>
<li>old   没有</li>
<li>new   插入的新数据</li>
</ul>
</li>
<li>
update
<ul>
<li>old   修改前的旧数据</li>
<li>new   修改后的新数据</li>
</ul>
</li>
<li>
delete
<ul>
<li>old   被删除的数据</li>
<li>new   没有</li>
</ul>
</li>
<li>
old和new表示一行数据
<ul>
<li>访问其中的字段：</li>
<li>old.a</li>
<li>new.b</li>
</ul>
</li>
</ul>
<h4>13.5.1创建触发器</h4>
<pre><code>use jtdb;
desc tb_user;
插入新用户数据时，在updated和created字段，自动填入系统当前时间
delimiter //
create trigger user_before_insert
before insert on tb_user
for each row
begin
   set new.created=now();
   set new.updated=now();
end //
delimiter ;
insert into tb_user(username,password)
values('a', md5('123'));
select * from tb_user
order by id desc limit 1;
</code></pre>

<h4>13.5.2查看触发器</h4>
<pre><code>进入系统库 information_schema
use information_schema
查询 triggers 表
select * from triggers\G
查看指定库中指定表的触发器
select * from triggers
where TRIGGER_SCHEMA='jtdb'
and EVENT_OBJECT_TABLE='tb_user'\G
</code></pre>

<h4>13.5.3删除触发器</h4>
<pre><code>drop trigger user_before_insert;
</code></pre>

<h4>13.5.4触发器测试</h4>
<pre><code>修改用户数据时，
created字段必须保持原值
updated字段改成系统当前时间
delimiter //
create trigger user_before_update
before update on tb_user
for each row
begin
   set new.created=old.created;
   set new.updated=now();
end //
delimiter ;
update tb_user set password=md5('999'),
created='2000-1-1 0:0:0'
order by id desc limit 1;
select * from tb_user
order by id desc limit 1;
不允许执行商品表的删除操作
use jtdb2;
delimiter //
create trigger item_before_delete
before delete on tb_item
for each row
begin
   -- 产生错误，来阻止delete的执行
   -- 暴力产生错误
   delete from can_not_delete_from_tb_item;
end//
delimiter ;
delete from tb_item limit 1;
</code></pre>


</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
